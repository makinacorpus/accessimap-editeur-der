function exportSvg(){function a(){var a=[window.document],c=[];iframes=document.querySelectorAll("iframe"),objects=document.querySelectorAll("object"),[].forEach.call(iframes,function(b){try{b.contentDocument&&a.push(b.contentDocument)}catch(c){console.log(c)}}),[].forEach.call(objects,function(b){try{b.contentDocument&&a.push(b.contentDocument)}catch(c){console.log(c)}}),a.forEach(function(a){for(var b=f(a),e=d(a,b),g=0;g<e.length;g++)c.push(e[g])}),c.length>1?b(c):c.length>0?e(c[0]):alert("The Crowbar couldn’t find any SVG nodes.")}function b(a){c(),a.forEach(function(b){a.forEach(function(a){b!==a&&Math.abs(b.top-a.top)<38&&Math.abs(b.left-a.left)<38&&(a.top+=38,a.left+=38)})});var b=document.createElement("div");h.appendChild(b),b.setAttribute("class","svg-crowbar"),b.style["z-index"]=1e7,b.style.position="absolute",b.style.top=0,b.style.left=0;var d=document.createElement("div");h.appendChild(d),d.setAttribute("class","svg-crowbar"),d.style.background="rgba(255, 255, 255, 0.7)",d.style.position="fixed",d.style.left=0,d.style.top=0,d.style.width="100%",d.style.height="100%",a.forEach(function(a,c){var d=document.createElement("div");b.appendChild(d),d.setAttribute("class","svg-crowbar"),d.style.position="absolute",d.style.top=a.top+document.body.scrollTop+"px",d.style.left=document.body.scrollLeft+a.left+"px",d.style.padding="4px",d.style["border-radius"]="3px",d.style.color="white",d.style["text-align"]="center",d.style["font-family"]="'Helvetica Neue'",d.style.background="rgba(0, 0, 0, 0.8)",d.style["box-shadow"]="0px 4px 18px rgba(0, 0, 0, 0.4)",d.style.cursor="move",d.textContent="SVG #"+c+": "+(a.id?"#"+a.id:"")+(a["class"]?"."+a["class"]:"");var f=document.createElement("button");d.appendChild(f),f.setAttribute("data-source-id",c),f.style.width="150px",f.style["font-size"]="12px",f.style["line-height"]="1.4em",f.style.margin="5px 0 0 0",f.textContent="Download",f.onclick=function(){e(a)}})}function c(){var a=document.querySelectorAll(".svg-crowbar");[].forEach.call(a,function(a){a.parentNode.removeChild(a)})}function d(a,b){var c=[],d=a.querySelectorAll("svg");return b=void 0===b?"":b,[].forEach.call(d,function(a){a.setAttribute("version","1.1");var d=document.createElement("defs");a.insertBefore(d,a.firstChild);var e=document.createElement("style");d.appendChild(e),e.setAttribute("type","text/css"),a.removeAttribute("xmlns"),a.removeAttribute("xlink"),a.hasAttributeNS(i.xmlns,"xmlns")||a.setAttributeNS(i.xmlns,"xmlns",i.svg),a.hasAttributeNS(i.xmlns,"xmlns:xlink")||a.setAttributeNS(i.xmlns,"xmlns:xlink",i.xlink);var f=(new XMLSerializer).serializeToString(a).replace("</style>","<![CDATA["+b+"]]></style>"),h=a.getBoundingClientRect();c.push({top:h.top,left:h.left,width:h.width,height:h.height,"class":a.getAttribute("class"),id:a.getAttribute("id"),childElementCount:a.childElementCount,source:[g+f]})}),c}function e(a){var b="map",c=window.URL.createObjectURL(new Blob(a.source,{type:"text/xml"})),d=document.createElement("a");h.appendChild(d),d.setAttribute("class","svg-crowbar"),d.setAttribute("download",b+".svg"),d.setAttribute("href",c),d.style.display="none",d.click(),setTimeout(function(){window.URL.revokeObjectURL(c)},10)}function f(a){function b(a){if(a.cssRules)for(var d=0;d<a.cssRules.length;d++){var e=a.cssRules[d];3===e.type?b(e.styleSheet):e.selectorText&&-1===e.selectorText.indexOf(">")&&(c+="\n"+e.cssText)}}var c="",d=a.styleSheets;if(d)for(var e=0;e<d.length;e++)b(d[e]);return c}var g='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';window.URL=window.URL||window.webkitURL;var h=document.body,i={xmlns:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"};a()}d3.geo.tile=function(){function a(){var a=Math.max(Math.log(c)/Math.LN2-8,0),f=Math.round(a+e),g=Math.pow(2,a-f+8),h=[(d[0]-c/2)/g,(d[1]-c/2)/g],i=[],j=d3.range(Math.max(0,Math.floor(-h[0])),Math.max(0,Math.ceil(b[0]/g-h[0]))),k=d3.range(Math.max(0,Math.floor(-h[1])),Math.max(0,Math.ceil(b[1]/g-h[1])));return k.forEach(function(a){j.forEach(function(b){i.push([b,a,f])})}),i.translate=h,i.scale=g,i}var b=[960,500],c=256,d=[b[0]/2,b[1]/2],e=0;return a.size=function(c){return arguments.length?(b=c,a):b},a.scale=function(b){return arguments.length?(c=b,a):c},a.translate=function(b){return arguments.length?(d=b,a):d},a.zoomDelta=function(b){return arguments.length?(e=+b,a):e},a},!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.osmtogeojson=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./lodash.custom.js"),d=a("geojson-rewind"),e=a("./polygon_features.json"),f={};f=function(a,b){function f(a){function b(a){var b=c.clone(a);b.lat=a.center.lat,b.lon=a.center.lon,b.__is_center_placeholder=!0,g.push(b)}function d(a){function b(a,b,c){var e={type:"node",id:"_"+d.type+"/"+d.id+"bounds"+c,lat:a,lon:b};d.nodes.push(e.id),g.push(e)}var d=c.clone(a);d.nodes=[],b(d.bounds.minlat,d.bounds.minlon,1),b(d.bounds.maxlat,d.bounds.minlon,2),b(d.bounds.maxlat,d.bounds.maxlon,3),b(d.bounds.minlat,d.bounds.maxlon,4),d.nodes.push(d.nodes[0]),d.__is_bounds_placeholder=!0,i.push(d)}function e(a){function b(a,b,c){var d={type:"node",id:c,lat:a,lon:b};g.push(d)}c.isArray(a.nodes)||(a.nodes=a.geometry.map(function(a){return null!==a?"_anonymous@"+a.lat+"/"+a.lon:"_anonymous@unknown_location"})),a.geometry.forEach(function(c,d){c&&b(c.lat,c.lon,a.nodes[d])})}function f(a){function b(a,b,c){var d={type:"node",id:c,lat:a,lon:b};g.push(d)}function c(a,b){function c(a,b){var c={type:"node",id:"_anonymous@"+a+"/"+b,lat:a,lon:b};d.nodes.push(c.id),g.push(c)}if(!i.some(function(a){return"way"==a.type&&a.id==b})){var d={type:"way",id:b,nodes:[]};a.forEach(function(a){a?c(a.lat,a.lon):d.nodes.push(void 0)}),i.push(d)}}a.members.forEach(function(a){"node"==a.type?a.lat&&b(a.lat,a.lon,a.ref):"way"==a.type&&a.geometry&&c(a.geometry,a.ref)})}for(var g=new Array,i=new Array,j=new Array,k=0;k<a.elements.length;k++)switch(a.elements[k].type){case"node":var l=a.elements[k];g.push(l);break;case"way":var m=c.clone(a.elements[k]);m.nodes=c.clone(m.nodes),i.push(m),m.center&&b(m),m.geometry?e(m):m.bounds&&d(m);break;case"relation":var n=c.clone(a.elements[k]);n.members=c.clone(n.members),j.push(n);var o=n.members&&n.members.some(function(a){return"node"==a.type&&a.lat||"way"==a.type&&a.geometry});n.center&&b(n),o?f(n):n.bounds&&d(n)}return h(g,i,j)}function g(a){function b(a,b,c){a.hasAttribute(c)&&(b[c]=a.getAttribute(c))}function d(a,d){var e=c.clone(a);b(d,e,"lat"),b(d,e,"lon"),e.__is_center_placeholder=!0,i.push(e)}function e(a,b){function d(a,b,c){var d={type:"node",id:"_"+e.type+"/"+e.id+"bounds"+c,lat:a,lon:b};e.nodes.push(d.id),i.push(d)}var e=c.clone(a);e.nodes=[],d(b.getAttribute("minlat"),b.getAttribute("minlon"),1),d(b.getAttribute("maxlat"),b.getAttribute("minlon"),2),d(b.getAttribute("maxlat"),b.getAttribute("maxlon"),3),d(b.getAttribute("minlat"),b.getAttribute("maxlon"),4),e.nodes.push(e.nodes[0]),e.__is_bounds_placeholder=!0,j.push(e)}function f(a,b){function d(a,b,c){var d={type:"node",id:c,lat:a,lon:b};return i.push(d),d.id}c.isArray(a.nodes)||(a.nodes=[],c.each(b,function(b){a.nodes.push("_anonymous@"+b.getAttribute("lat")+"/"+b.getAttribute("lon"))})),c.each(b,function(b,c){b.getAttribute("lat")&&d(b.getAttribute("lat"),b.getAttribute("lon"),a.nodes[c])})}function g(a,b){function d(a,b,c){var d={type:"node",id:c,lat:a,lon:b};i.push(d)}function e(a,b){function d(a,b){var c={type:"node",id:"_anonymous@"+a+"/"+b,lat:a,lon:b};e.nodes.push(c.id),i.push(c)}if(!j.some(function(a){return"way"==a.type&&a.id==b})){var e={type:"way",id:b,nodes:[]};c.each(a,function(a){a.getAttribute("lat")?d(a.getAttribute("lat"),a.getAttribute("lon")):e.nodes.push(void 0)}),j.push(e)}}c.each(b,function(b,c){"node"==a.members[c].type?b.getAttribute("lat")&&d(b.getAttribute("lat"),b.getAttribute("lon"),a.members[c].ref):"way"==a.members[c].type&&b.getElementsByTagName("nd").length>0&&e(b.getElementsByTagName("nd"),a.members[c].ref)})}var i=new Array,j=new Array,k=new Array;c.each(a.getElementsByTagName("node"),function(a){var d={};c.each(a.getElementsByTagName("tag"),function(a){d[a.getAttribute("k")]=a.getAttribute("v")});var e={type:"node"};b(a,e,"id"),b(a,e,"lat"),b(a,e,"lon"),b(a,e,"version"),b(a,e,"timestamp"),b(a,e,"changeset"),b(a,e,"uid"),b(a,e,"user"),c.isEmpty(d)||(e.tags=d),i.push(e)});var l,m;return c.each(a.getElementsByTagName("way"),function(a){var g={},h=[];c.each(a.getElementsByTagName("tag"),function(a){g[a.getAttribute("k")]=a.getAttribute("v")});var i=!1;c.each(a.getElementsByTagName("nd"),function(a,b){var c;(c=a.getAttribute("ref"))&&(h[b]=c),!i&&a.getAttribute("lat")&&(i=!0)});var k={type:"way"};b(a,k,"id"),b(a,k,"version"),b(a,k,"timestamp"),b(a,k,"changeset"),b(a,k,"uid"),b(a,k,"user"),h.length>0&&(k.nodes=h),c.isEmpty(g)||(k.tags=g),(l=a.getElementsByTagName("center")[0])&&d(k,l),i?f(k,a.getElementsByTagName("nd")):(m=a.getElementsByTagName("bounds")[0])&&e(k,m),j.push(k)}),c.each(a.getElementsByTagName("relation"),function(a){var f={},h=[];c.each(a.getElementsByTagName("tag"),function(a){f[a.getAttribute("k")]=a.getAttribute("v")});var i=!1;c.each(a.getElementsByTagName("member"),function(a,c){h[c]={},b(a,h[c],"ref"),b(a,h[c],"role"),b(a,h[c],"type"),(!i&&"node"==h[c].type&&a.getAttribute("lat")||"way"==h[c].type&&a.getElementsByTagName("nd").length>0)&&(i=!0)});var j={type:"relation"};b(a,j,"id"),b(a,j,"version"),b(a,j,"timestamp"),b(a,j,"changeset"),b(a,j,"uid"),b(a,j,"user"),h.length>0&&(j.members=h),c.isEmpty(f)||(j.tags=f),(l=a.getElementsByTagName("center")[0])&&d(j,l),i?g(j,a.getElementsByTagName("member")):(m=a.getElementsByTagName("bounds")[0])&&e(j,m),k.push(j)}),h(i,j,k)}function h(a,e,f){function g(a,c){if("object"!=typeof c&&(c={}),"function"==typeof b.uninterestingTags)return!b.uninterestingTags(a,c);for(var d in a)if(b.uninterestingTags[d]!==!0&&c[d]!==!0&&c[d]!==a[d])return!0;return!1}function h(a){var b={timestamp:a.timestamp,version:a.version,changeset:a.changeset,user:a.user,uid:a.uid};for(k in b)void 0===b[k]&&delete b[k];return b}function j(a,d){function e(c){for(var d,e,f,g,h,i,k=function(a){return a[0]},l=function(a){return a[a.length-1]},m=[];c.length;)for(d=c.pop().nodes.slice(),m.push(d);c.length&&k(d)!==l(d);){for(e=k(d),f=l(d),g=0;g<c.length;g++){if(i=c[g].nodes,f===k(i)){h=d.push,i=i.slice(1);break}if(f===l(i)){h=d.push,i=i.slice(0,-1).reverse();break}if(e==l(i)){h=d.unshift,i=i.slice(0,-1);break}if(e==k(i)){h=d.unshift,i=i.slice(1).reverse();break}i=h=null}if(!i){b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains unclosed ring geometry");break}c.splice(g,1),h.apply(d,i)}return m}function f(a){var b,c,d=function(a,b){for(var c=0;c<b.length;c++)if(f(b[c],a))return!0;return!1},e=function(a){return a.map(function(a){return[+a.lat,+a.lon]})},f=function(a,b){for(var c=a[0],d=a[1],e=!1,f=0,g=b.length-1;f<b.length;g=f++){var h=b[f][0],i=b[f][1],j=b[g][0],k=b[g][1],l=i>d!=k>d&&(j-h)*(d-i)/(k-i)+h>c;l&&(e=!e)}return e};for(a=e(a),b=0;b<k.length;b++)if(c=e(k[b]),d(c,a))return b}var g,i=!1,j=D?"way":"relation";g=d.members.filter(function(a){return"way"===a.type}),g=g.map(function(c){var d=p[c.ref];return void 0===d?(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"tainted by a missing way",c.type+"/"+c.ref),void(i=!0)):{id:c.ref,role:c.role||"outer",way:d,nodes:d.nodes.filter(function(d){return void 0!==d?!0:(i=!0,b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"tainted by a way",c.type+"/"+c.ref,"with a missing node"),!1)})}}),g=c.compact(g);var k,l;k=e(g.filter(function(a){return"outer"===a.role})),l=e(g.filter(function(a){return"inner"===a.role}));var m;m=k.map(function(a){return[a]});for(var n=0;n<l.length;n++){var o=f(l[n]);void 0!==o?m[o].push(l[n]):b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains an inner ring with no containing outer")}var q=[];if(q=c.compact(m.map(function(d){var e=c.compact(d.map(function(d){return d.length<4?void(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains a ring with less than four nodes")):c.compact(d.map(function(a){return[+a.lon,+a.lat]}))}));return 0==e.length?void(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains an empty ring cluster")):e})),0==q.length)return b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains no coordinates"),!1;var r="MultiPolygon";1===q.length&&(r="Polygon",q=q[0]);var s={type:"Feature",id:a.type+"/"+a.id,properties:{type:a.type,id:a.id,tags:a.tags||{},relations:t[a.type][a.id]||[],meta:h(a)},geometry:{type:r,coordinates:q}};return i&&(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"is tainted"),s.properties.tainted=!0),s}for(var l=new Object,m=0;m<a.length;m++)void 0!==a[m].lat?l[a[m].id]=a[m]:b.verbose&&console.warn("Node",a[m].type+"/"+a[m].id,"ignored because it has no coordinates");for(var n=new Object,m=0;m<a.length;m++)"undefined"!=typeof a[m].tags&&g(a[m].tags)&&(n[a[m].id]=!0);for(var m=0;m<f.length;m++)if(c.isArray(f[m].members))for(var o=0;o<f[m].members.length;o++)"node"==f[m].members[o].type&&(n[f[m].members[o].ref]=!0);else b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"ignored because it has no members");for(var p=new Object,q=new Object,m=0;m<e.length;m++)if(c.isArray(e[m].nodes)){p[e[m].id]=e[m];for(var o=0;o<e[m].nodes.length;o++)q[e[m].nodes[o]]=!0,e[m].nodes[o]=l[e[m].nodes[o]]}else b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"ignored because it has no nodes");for(var r=new Array,m=0;m<a.length;m++)(!q[a[m].id]||n[a[m].id])&&r.push(a[m]);for(var s=new Array,m=0;m<f.length;m++)c.isArray(f[m].members)?s[f[m].id]=f[m]:b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"ignored because it has no members");for(var t={node:{},way:{},relation:{}},m=0;m<f.length;m++)if(c.isArray(f[m].members))for(var o=0;o<f[m].members.length;o++){var u;switch(f[m].members[o].type){case"node":u=l[f[m].members[o].ref];break;case"way":u=p[f[m].members[o].ref];break;case"relation":u=s[f[m].members[o].ref]}if(u){var v=f[m].members[o].type,w=f[m].members[o].ref;"undefined"==typeof t[v][w]&&(t[v][w]=[]),t[v][w].push({role:f[m].members[o].role,rel:f[m].id,reltags:f[m].tags})}else b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"member",f[m].members[o].type+"/"+f[m].members[o].id,"ignored because it has an invalid type")}else b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"ignored because it has no members");var x,y={type:"FeatureCollection",features:new Array};for(m=0;m<r.length;m++)if("undefined"!=typeof r[m].lon&&"undefined"!=typeof r[m].lat){var z={type:"Feature",id:r[m].type+"/"+r[m].id,properties:{type:r[m].type,id:r[m].id,tags:r[m].tags||{},relations:t.node[r[m].id]||[],meta:h(r[m])},geometry:{type:"Point",coordinates:[+r[m].lon,+r[m].lat]}};r[m].__is_center_placeholder&&(z.properties.geometry="center"),y.features.push(z)}else b.verbose&&console.warn("POI",r[m].type+"/"+r[m].id,"ignored because it lacks coordinates");for(var A={type:"FeatureCollection",features:new Array},B={type:"FeatureCollection",features:new Array},m=0;m<f.length;m++)if("undefined"!=typeof f[m].tags&&("multipolygon"==f[m].tags.type||"boundary"==f[m].tags.type)){if(!c.isArray(f[m].members)){b.verbose&&console.warn("Multipolygon",f[m].type+"/"+f[m].id,"ignored because it has no members");continue}for(var C=0,o=0;o<f[m].members.length;o++)"outer"==f[m].members[o].role?C++:b.verbose&&"inner"!=f[m].members[o].role&&console.warn("Multipolygon",f[m].type+"/"+f[m].id,"member",f[m].members[o].type+"/"+f[m].members[o].ref,'ignored because it has an invalid role: "'+f[m].members[o].role+'"');if(f[m].members.forEach(function(a){p[a.ref]&&("outer"!==a.role||g(p[a.ref].tags,f[m].tags)||(p[a.ref].is_multipolygon_outline=!0),"inner"!==a.role||g(p[a.ref].tags)||(p[a.ref].is_multipolygon_outline=!0))}),0==C){b.verbose&&console.warn("Multipolygon relation",f[m].type+"/"+f[m].id,"ignored because it has no outer ways");continue}var D=!1;1!=C||g(f[m].tags,{type:!0})||(D=!0);var z=null;if(D){var E=f[m].members.filter(function(a){return"outer"===a.role})[0];if(E=p[E.ref],void 0===E){b.verbose&&console.warn("Multipolygon relation",f[m].type+"/"+f[m].id,"ignored because outer way",E.type+"/"+E.ref,"is missing");continue}E.is_multipolygon_outline=!0,z=j(E,f[m])}else z=j(f[m],f[m]);if(z===!1){b.verbose&&console.warn("Multipolygon relation",f[m].type+"/"+f[m].id,"ignored because it has invalid geometry");continue}B.features.push(z)}for(var m=0;m<e.length;m++)if(c.isArray(e[m].nodes)){if(!e[m].is_multipolygon_outline){for(e[m].tainted=!1,e[m].hidden=!1,coords=new Array,o=0;o<e[m].nodes.length;o++)"object"==typeof e[m].nodes[o]?coords.push([+e[m].nodes[o].lon,+e[m].nodes[o].lat]):(b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"is tainted by an invalid node"),e[m].tainted=!0);if(coords.length<=1)b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"ignored because it contains too few nodes");else{var F="LineString";"undefined"!=typeof e[m].nodes[0]&&e[m].nodes[0]===e[m].nodes[e[m].nodes.length-1]&&("undefined"!=typeof e[m].tags&&i(e[m].tags)||e[m].__is_bounds_placeholder)&&(F="Polygon",coords=[coords]);var z={type:"Feature",id:e[m].type+"/"+e[m].id,properties:{type:e[m].type,id:e[m].id,tags:e[m].tags||{},relations:t.way[e[m].id]||[],meta:h(e[m])},geometry:{type:F,coordinates:coords}};e[m].tainted&&(b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"is tainted"),z.properties.tainted=!0),e[m].__is_bounds_placeholder&&(z.properties.geometry="bounds"),"LineString"==F?A.features.push(z):B.features.push(z)}}}else b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"ignored because it has no nodes");return x={type:"FeatureCollection",features:[]},x.features=x.features.concat(B.features),x.features=x.features.concat(A.features),x.features=x.features.concat(y.features),b.flatProperties&&x.features.forEach(function(a){a.properties=c.merge(a.properties.meta,a.properties.tags,{id:a.properties.type+"/"+a.properties.id})}),x=d(x,!0)}function i(a){var c=b.polygonFeatures;if("function"==typeof c)return c(a);if("no"===a.area)return!1;for(var d in a){var e=a[d],f=c[d];if("undefined"!=typeof f&&"no"!==e){if(f===!0)return!0;if(f.included_values&&f.included_values[e]===!0)return!0;if(f.excluded_values&&f.excluded_values[e]!==!0)return!0}}return!1}b=c.merge({verbose:!1,flatProperties:!1,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:e},b);var j;return j="undefined"!=typeof XMLDocument&&a instanceof XMLDocument||"undefined"==typeof XMLDocument&&a.childNodes?g(a):f(a)},f.toGeojson=f,b.exports=f},{"./lodash.custom.js":2,"./polygon_features.json":6,"geojson-rewind":3}],2:[function(a,b,c){(function(a){(function(){function d(){return F.pop()||[]}function e(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function f(a){a.length=0,F.length<H&&F.push(a)}function g(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function h(){}function i(a){function b(){if(d){var a=g(d);mb.apply(a,arguments)}if(this instanceof b){var f=l(c.prototype),h=c.apply(f,a||arguments);return x(h)?h:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return xb(b,a),b}function j(a,b,c,h,i){if(c){var k=c(a);if("undefined"!=typeof k)return k}var l=x(a);if(!l)return a;var m=hb.call(a);if(!W[m]||!vb.nodeClass&&e(a))return a;var n=tb[m];switch(m){case O:case P:return new n(+a);case S:case V:return new n(a);case U:return k=n(a.source,I.exec(a)),k.lastIndex=a.lastIndex,k}var o=yb(a);if(b){var p=!h;h||(h=d()),i||(i=d());for(var q=h.length;q--;)if(h[q]==a)return i[q];k=o?n(a.length):{}}else k=o?g(a):Fb({},a);return o&&(lb.call(a,"index")&&(k.index=a.index),lb.call(a,"input")&&(k.input=a.input)),b?(h.push(a),i.push(k),(o?Eb:Hb)(a,function(a,d){k[d]=j(a,b,c,h,i)}),p&&(f(h),f(i)),k):k}function l(a){return x(a)?qb(a):{}}function m(a,b,c){if("function"!=typeof a)return D;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(vb.funcNames&&(d=!a.name),d=d||!vb.funcDecomp,!d)){var e=jb.call(a);vb.funcNames||(d=!J.test(e)),d||(d=K.test(e),xb(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return C(a,b)}function n(a){function b(){var a=j?h:this;if(e){var q=g(e);mb.apply(q,arguments)}if((f||m)&&(q||(q=g(arguments)),f&&mb.apply(q,f),m&&q.length<i))return d|=16,n([c,o?d:-4&d,q,null,h,i]);if(q||(q=arguments),k&&(c=a[p]),this instanceof b){a=l(c.prototype);var r=c.apply(a,q);return x(r)?r:a}return c.apply(a,q)}var c=a[0],d=a[1],e=a[2],f=a[3],h=a[4],i=a[5],j=1&d,k=2&d,m=4&d,o=8&d,p=c;return xb(b,a),b}function o(a,b,c,d,e){(yb(b)?A:Hb)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=yb(b))||Ib(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?yb(j)?j:[]:Ib(j)?j:{}),d.push(b),e.push(j),l||o(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function p(a,b,c,d,e,f){var h=1&b,j=2&b,k=4&b,l=16&b,m=32&b;if(!j&&!w(a))throw new TypeError;l&&!c.length&&(b&=-17,l=c=!1),m&&!d.length&&(b&=-33,m=d=!1);var o=a&&a.__bindData__;if(o&&o!==!0)return o=g(o),o[2]&&(o[2]=g(o[2])),o[3]&&(o[3]=g(o[3])),!h||1&o[1]||(o[4]=e),!h&&1&o[1]&&(b|=8),!k||4&o[1]||(o[5]=f),l&&mb.apply(o[2]||(o[2]=[]),c),m&&ob.apply(o[3]||(o[3]=[]),d),o[1]|=b,p.apply(null,o);var q=1==b||17===b?i:n;return q([a,b,c,d,e,f])}function q(){Y.shadowedProps=L,Y.array=Y.bottom=Y.loop=Y.top="",Y.init="iterable",Y.useHas=!0;for(var a,b=0;a=arguments[b];b++)for(var c in a)Y[c]=a[c];var d=Y.args;Y.firstArg=/^[^,]+/.exec(d)[0];var e=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+d+") {\n"+wb(Y)+"\n}");return e(m,Q,eb,lb,G,t,yb,y,Y.keys,fb,Z,ub,V,gb,hb)}function r(a){return"function"==typeof a&&ib.test(a)}function s(a){var b,c;return!a||hb.call(a)!=T||(b=a.constructor,w(b)&&!(b instanceof b))||!vb.argsClass&&t(a)||!vb.nodeClass&&e(a)?!1:vb.ownLast?(Gb(a,function(a,b,d){return c=lb.call(d,b),!1}),c!==!1):(Gb(a,function(a,b){c=b}),"undefined"==typeof c||lb.call(a,c))}function t(a){return a&&"object"==typeof a&&"number"==typeof a.length&&hb.call(a)==M||!1}function u(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),j(a,b,"function"==typeof c&&m(c,d,1))}function v(a){var b=!0;if(!a)return b;var c=hb.call(a),d=a.length;return c==N||c==V||(vb.argsClass?c==M:t(a))||c==T&&"number"==typeof d&&w(a.splice)?!d:(Hb(a,function(){return b=!1}),b)}function w(a){return"function"==typeof a}function x(a){return!(!a||!Z[typeof a])}function y(a){return"string"==typeof a||a&&"object"==typeof a&&hb.call(a)==V||!1}function z(a){var b=arguments,c=2;if(!x(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var e=m(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(e=b[--c]);for(var h=g(arguments,1,c),i=-1,j=d(),k=d();++i<c;)o(a,h[i],e,j,k);return f(j),f(k),a}function A(a,b,c){if(b&&"undefined"==typeof c&&yb(a))for(var d=-1,e=a.length;++d<e&&b(a[d],d,a)!==!1;);else Eb(a,b,c);return a}function B(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function C(a,b){return arguments.length>2?p(a,17,g(arguments,2),null,b):p(a,1,null,null,b)}function D(a){return a}function E(){}var F=[],G={},H=40,I=/\w*$/,J=/^\s*function[ \n\r\t]+\w/,K=/\bthis\b/,L=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],M="[object Arguments]",N="[object Array]",O="[object Boolean]",P="[object Date]",Q="[object Error]",R="[object Function]",S="[object Number]",T="[object Object]",U="[object RegExp]",V="[object String]",W={};W[R]=!1,W[M]=W[N]=W[O]=W[P]=W[S]=W[T]=W[U]=W[V]=!0;var X={configurable:!1,enumerable:!1,value:null,writable:!1},Y={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},Z={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},$=Z[typeof window]&&window||this,_=Z[typeof c]&&c&&!c.nodeType&&c,ab=Z[typeof b]&&b&&!b.nodeType&&b,bb=ab&&ab.exports===_&&_,cb=Z[typeof a]&&a;!cb||cb.global!==cb&&cb.window!==cb||($=cb);var db=[],eb=Error.prototype,fb=Object.prototype,gb=String.prototype,hb=fb.toString,ib=RegExp("^"+String(hb).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),jb=Function.prototype.toString,kb=r(kb=Object.getPrototypeOf)&&kb,lb=fb.hasOwnProperty,mb=db.push,nb=fb.propertyIsEnumerable,ob=db.unshift,pb=function(){try{var a={},b=r(b=Object.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),qb=r(qb=Object.create)&&qb,rb=r(rb=Array.isArray)&&rb,sb=r(sb=Object.keys)&&sb,tb={};tb[N]=Array,tb[O]=Boolean,tb[P]=Date,tb[R]=Function,tb[T]=Object,tb[S]=Number,tb[U]=RegExp,tb[V]=String;var ub={};ub[N]=ub[P]=ub[S]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ub[O]=ub[V]={constructor:!0,toString:!0,valueOf:!0},ub[Q]=ub[R]=ub[U]={constructor:!0,toString:!0},ub[T]={constructor:!0},function(){for(var a=L.length;a--;){var b=L[a];for(var c in ub)lb.call(ub,c)&&!lb.call(ub[c],b)&&(ub[c][b]=!1)}}();var vb=h.support={};!function(){var a=function(){this.x=1},b={0:1,length:1},c=[];a.prototype={valueOf:1,y:1};for(var d in new a)c.push(d);for(d in arguments);vb.argsClass=hb.call(arguments)==M,vb.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),vb.enumErrorProps=nb.call(eb,"message")||nb.call(eb,"name"),vb.enumPrototypes=nb.call(a,"prototype"),vb.funcDecomp=!r($.WinRTError)&&K.test(function(){return this}),vb.funcNames="string"==typeof Function.name,vb.nonEnumArgs=0!=d,vb.nonEnumShadows=!/valueOf/.test(c),vb.ownLast="x"!=c[0],vb.spliceObjects=(db.splice.call(b,0,1),!b[0]),vb.unindexedChars="x"[0]+Object("x")[0]!="xx";try{vb.nodeClass=!(hb.call(document)==T&&!({toString:0}+""))}catch(e){vb.nodeClass=!0}}(1);var wb=function(a){var b="var index, iterable = "+a.firstArg+", result = "+a.init+";\nif (!iterable) return result;\n"+a.top+";";a.array?(b+="\nvar length = iterable.length; index = -1;\nif ("+a.array+") {  ",vb.unindexedChars&&(b+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),b+="\n  while (++index < length) {\n    "+a.loop+";\n  }\n}\nelse {  "):vb.nonEnumArgs&&(b+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+a.loop+";\n    }\n  } else {  "),vb.enumPrototypes&&(b+="\n  var skipProto = typeof iterable == 'function';\n  "),vb.enumErrorProps&&(b+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var c=[];if(vb.enumPrototypes&&c.push('!(skipProto && index == "prototype")'),vb.enumErrorProps&&c.push('!(skipErrorProps && (index == "message" || index == "name"))'),a.useHas&&a.keys)b+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }  ";else if(b+="\n  for (index in iterable) {\n",a.useHas&&c.push("hasOwnProperty.call(iterable, index)"),c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }    ",vb.nonEnumShadows){for(b+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)b+="\n    index = '"+a.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",a.useHas||(b+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),b+=") {\n      "+a.loop+";\n    }      ";b+="\n  }    "}return(a.array||vb.nonEnumArgs)&&(b+="\n}"),b+=a.bottom+";\nreturn result"};qb||(l=function(){function a(){}return function(b){if(x(b)){a.prototype=b;var c=new a;a.prototype=null}return c||$.Object()}}());var xb=pb?function(a,b){X.value=b,pb(a,"__bindData__",X)}:E;vb.argsClass||(t=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&lb.call(a,"callee")&&!nb.call(a,"callee")||!1});var yb=rb||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&hb.call(a)==N||!1},zb=q({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Ab=sb?function(a){return x(a)?vb.enumPrototypes&&"function"==typeof a||vb.nonEnumArgs&&a.length&&t(a)?zb(a):sb(a):[]}:zb,Bb={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:Ab,loop:"if (callback(iterable[index], index, collection) === false) return result"},Cb={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:Ab,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Db={top:"if (!objectTypes[typeof iterable]) return result;\n"+Bb.top,array:!1},Eb=q(Bb),Fb=q(Cb,{top:Cb.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Gb=q(Bb,Db,{useHas:!1}),Hb=q(Bb,Db);w(/x/)&&(w=function(a){return"function"==typeof a&&hb.call(a)==R});var Ib=kb?function(a){if(!a||hb.call(a)!=T||!vb.argsClass&&t(a))return!1;var b=a.valueOf,c=r(b)&&(c=kb(b))&&kb(c);return c?a==c||kb(a)==c:s(a)}:s;h.assign=Fb,h.bind=C,h.compact=B,h.forEach=A,h.forIn=Gb,h.forOwn=Hb,h.keys=Ab,h.merge=z,h.each=A,h.extend=Fb,h.clone=u,h.identity=D,h.isArguments=t,h.isArray=yb,h.isEmpty=v,h.isFunction=w,h.isObject=x,h.isPlainObject=Ib,h.isString=y,h.noop=E,h.VERSION="2.4.1",_&&ab&&bb&&((ab.exports=h)._=h)}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b){function c(a,b){switch(a&&a.type||null){case"FeatureCollection":return a.features=a.features.map(d(c,b)),a;case"Feature":return a.geometry=c(a.geometry,b),a;case"Polygon":case"MultiPolygon":return e(a,b);default:return a}}function d(a,b){return function(c){return a(c,b)}}function e(a,b){return"Polygon"===a.type?a.coordinates=f(a.coordinates,b):"MultiPolygon"===a.type&&(a.coordinates=a.coordinates.map(d(f,b))),a}function f(a,b){b=!!b,a[0]=g(a[0],!b);for(var c=1;c<a.length;c++)a[c]=g(a[c],b);return a}function g(a,b){return h(a)===b?a:a.reverse()}function h(a){return i.ring(a)>=0
}var i=a("geojson-area");b.exports=c},{"geojson-area":4}],4:[function(a,b){function c(a){if("Polygon"===a.type)return d(a.coordinates);if("MultiPolygon"===a.type){for(var b=0,c=0;c<a.coordinates.length;c++)b+=d(a.coordinates[c]);return b}return null}function d(a){var b=0;if(a&&a.length>0){b+=Math.abs(e(a[0]));for(var c=1;c<a.length;c++)b-=Math.abs(e(a[c]))}return b}function e(a){var b=0;if(a.length>2){for(var c,d,e=0;e<a.length-1;e++)c=a[e],d=a[e+1],b+=f(d[0]-c[0])*(2+Math.sin(f(c[1]))+Math.sin(f(d[1])));b=b*g.RADIUS*g.RADIUS/2}return b}function f(a){return a*Math.PI/180}var g=a("wgs84");b.exports.geometry=c,b.exports.ring=e},{wgs84:5}],5:[function(a,b){b.exports.RADIUS=6378137,b.exports.FLATTENING=1/298.257223563,b.exports.POLAR_RADIUS=6356752.3142},{}],6:[function(a,b){b.exports={building:!0,highway:{included_values:{services:!0,rest_area:!0,escape:!0}},natural:{excluded_values:{coastline:!0,ridge:!0,arete:!0,tree_row:!0}},landuse:!0,waterway:{included_values:{riverbank:!0,dock:!0,boatyard:!0,dam:!0}},amenity:!0,leisure:!0,barrier:{included_values:{city_wall:!0,ditch:!0,hedge:!0,retaining_wall:!0,wall:!0,spikes:!0}},railway:{included_values:{station:!0,turntable:!0,roundhouse:!0,platform:!0}},area:!0,boundary:!0,man_made:{excluded_values:{cutline:!0,embankment:!0,pipeline:!0}},power:{included_values:{plant:!0,substation:!0,generator:!0,transformer:!0}},place:!0,shop:!0,aeroway:{excluded_values:{taxiway:!0}},tourism:!0,historic:!0,public_transport:!0,office:!0,"building:part":!0,military:!0,ruins:!0,"area:highway":!0,craft:!0,golf:!0}},{}]},{},[1])(1)}),angular.module("accessimapEditeurDerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angularSpinner"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/localmap",{templateUrl:"views/localmap.html",controller:"LocalmapCtrl"}).when("/globalmap",{templateUrl:"views/globalmap.html",controller:"GlobalmapCtrl"}).when("/commonmap",{templateUrl:"views/commonmap.html",controller:"CommonmapCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("accessimapEditeurDerApp").controller("MainCtrl",["$scope","$location",function(a,b){a.go=function(a){b.path(a)}}]),angular.module("accessimapEditeurDerApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("accessimapEditeurDerApp").factory("settings",["editSvg",function(a){var b={GLOBAL_MAP_CENTER:[1.44,43.6],GLOBAL_MAP_DEFAULT_ZOOM:13},c=[{id:"trottoirs",name:"Trottoirs",type:"line",query:'way["footway"="sidewalk"]'},{id:"ppietons",name:"Passages piétons",type:"line",query:'way["footway"="crossing"]'},{id:"principales",name:"Routes principales",type:"line",query:'way["highway"~"motorway|trunk|primary|secondary"]'},{id:"places",name:"Places",type:"polygon",query:'way["highway"="pedestrian"]["area"="yes"]'},{id:"trafficSignals",name:"Feux tricolores",type:"point",query:'node["highway"="traffic_signals"]'},{id:"rues",name:"Toutes les rues",type:"line",query:'way["highway"]["footway"!="sidewalk"]["footway"!="crossing"]["area"!="yes"]'}],d={line:[{id:"straight",name:"Trait",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"4"},{k:"fill",v:"none"}]},{id:"dashed55",name:"Tirets 5 5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"5, 5"}]},{id:"dashed33",name:"Tirets 2 2",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"2, 2"}]},{id:"dashed1010",name:"Tirets 10 10",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"10,10"}]},{id:"dotted",name:"Ronds",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"10"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"1, 15"}]}],polygon:[{id:"filled",name:"Rempli",style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"2"},{k:"fill",v:"grey"}]}],point:[{id:"smallcircle",name:"Petit cercle",path:a.circlePath,radius:5,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"black"}]},{id:"bigcircle",name:"Grand cercle",path:a.circlePath,radius:15,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"black"}]}]},e="http://overpass-api.de/api/interpreter?data=";return{XAPI_URL:e,QUERY_LIST:c,STYLES:d,leaflet:b}}]),angular.module("accessimapEditeurDerApp").service("mapService",function(){this.formatLocation=function(a,b){var c=d3.format("."+Math.floor(Math.log(b)/2-2)+"f");return{lon:c(a[0]<0?-a[0]:a[0]),lat:c(a[1]<0?-a[1]:a[1])}}}),angular.module("accessimapEditeurDerApp").service("exportService",function(){this.mapExport=function(){d3.select(".tiles").selectAll("*").remove(),exportSvg()}}),angular.module("accessimapEditeurDerApp").controller("LocalmapCtrl",["$rootScope","$scope","$http","$location","usSpinnerService","initSvg","mapService","settings","exportService","shareSvg","editSvg",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b,c){var d=B.append("line").attr("x1",function(){return p-q+s}).attr("y1",function(){return 30*c+40}).attr("x2",function(){return p-q+s+40}).attr("y2",function(){return 30*c+40}).attr("fill","red");angular.forEach(b,function(a){d.attr(a.k,a.v)}),B.append("text").attr("x",function(){return p-q+s+50}).attr("y",function(){return 30*c+s+40}).attr("font-size","20px").attr("class","braille").text(function(){return a})}function m(){var a=t.scale(x.scale()).translate(x.translate())();angular.forEach(b.geojson,function(a){d3.selectAll("path."+a.id).filter(function(a){return"Point"!==a.geometry.type}).attr("d",w),d3.selectAll("path."+a.id).filter(function(a){return"Point"===a.geometry.type}).attr("d",function(b){return k.circlePath(u(b.geometry.coordinates)[0],u(b.geometry.coordinates)[1],a.style.width)})}),u.scale(x.scale()/2/Math.PI).translate(x.translate());var c=A.attr("transform","scale("+a.scale+")translate("+a.translate+")").selectAll("image").data(a,function(a){return a});c.exit().remove(),c.enter().append("image").attr("xlink:href",function(a){return"http://"+["a","b","c"][3*Math.random()|0]+".tile.osm.org/"+a[2]+"/"+a[0]+"/"+a[1]+".png"}).attr("width",1).attr("height",1).attr("x",function(a){return a[0]}).attr("y",function(a){return a[1]})}function n(){d3.select(".tiles").node().remove();var a=d3.select("svg").node();j.addSvg(a).then(function(){d.path("/commonmap")})}function o(){e.spin("spinner-1");var a=g.formatLocation(u.invert([0,0]),x.scale()),d=g.formatLocation(u.invert([p,r]),x.scale()),f=d.lat,i=a.lon,j=a.lat,n=d.lon;c.get(h.XAPI_URL+"[out:json];("+b.queryChosen.query+"("+f+","+i+","+j+","+n+"););out body;>;out skel qt;").success(function(a){var c=osmtogeojson(a);c.features.forEach(function(a){"Polygon"===a.geometry.type&&a.geometry.coordinates[0].reverse()}),z.append("g").attr("class","vector").attr("id",b.queryChosen.id).selectAll("path").data(c.features.filter(function(a){return"Point"!==a.geometry.type})).enter().append("path").attr("class",b.queryChosen.id).attr("d",w).data(c.features.filter(function(a){return"Point"===a.geometry.type})).enter().append("path").attr("class",b.queryChosen.id).attr("d",function(a){return k.circlePath(u(a.geometry.coordinates)[0],u(a.geometry.coordinates)[1],b.styleChosen.radius)}),angular.forEach(b.styleChosen.style,function(a){d3.select("#"+b.queryChosen.id).attr(a.k,a.v)}),z.call(x),b.geojson.push({id:b.queryChosen.id,name:b.queryChosen.name,layer:c,style:{width:b.styleChosen.radius}}),l(b.queryChosen.name,b.styleChosen.style,b.geojson.length),m(),e.stop("spinner-1")}).error(function(){e.stop("spinner-1")})}{var p=1e3,q=300,r=p/Math.sqrt(2),s=10,t=d3.geo.tile().size([p,r]),u=d3.geo.mercator().scale(2097152/Math.PI).translate([p/2,r/2]),v=u(h.leaflet.GLOBAL_MAP_CENTER),w=d3.geo.path().projection(u),x=d3.behavior.zoom().scale(2*u.scale()*Math.PI).scaleExtent([2048,1<<27]).translate([p-v[0],r-v[1]]).on("zoom",m).on("zoomend",m),y=f.createSvg(p,r),z=y.append("g").attr("width",function(){return p-q}).attr("height",r),A=z.append("g").attr("class","tiles"),B=y.append("g");B.append("rect").attr("x",function(){return p-q}).attr("y","0px").attr("width",function(){return q}).attr("height",r).attr("fill","white")}B.append("text").attr("x",function(){return p-q+s}).attr("y","30px").attr("class","braille").attr("font-size","20px").text(function(){return"legende"}),b.geojson=[],b.queryChoices=h.QUERY_LIST,b.queryChosen=b.queryChoices[0],b.styleChoices=h.STYLES[b.queryChosen.type],b.styleChosen=b.styleChoices[0],b.changeStyle=function(){b.styleChoices=h.STYLES[b.queryChosen.type],b.styleChosen=b.styleChoices[0]},z.call(x),m(),b.downloadData=o,b.mapCommon=n}]),angular.module("accessimapEditeurDerApp").controller("GlobalmapCtrl",["$scope","$rootScope","$http","$location","usSpinnerService","initSvg","mapService","settings","exportService","shareSvg",function(a,b,c,d,e,f,g,h,i,j){function k(b){a.accordionStyle={display:"none"},d3.xml(b,function(a){j.addSvg(a.documentElement).then(function(){d.path("/commonmap")})})}a.mapCategories=[{id:"world",name:"Monde",images:[{path:"data/BlankMap-World6-Equirectangular.svg"}]},{id:"france",name:"France",images:[{path:"data/France_all_regions_A4.svg"}]}],a.mapExport=i.mapExport,a.appendSvg=k}]),angular.module("accessimapEditeurDerApp").service("initSvg",function(){this.createSvg=function(a,b){return d3.select("#map").append("svg").attr("width",a).attr("height",b)}}),angular.module("accessimapEditeurDerApp").controller("CommonmapCtrl",["$rootScope","$scope","$location","settings","exportService","shareSvg",function(a,b,c,d,e,f){function g(){d3.selectAll("path").on("click",function(){}),d3.selectAll("svg").on("click",function(){}),d3.select("body").on("keydown",function(){}),$("#der").css("cursor","auto"),d3.select(".ongoing").remove()}d3.select("#der").selectAll("svg").remove(),f.getSvg().then(function(a){a?(b.data=a,d3.select("#der").node().appendChild(b.data)):c.path("/")}),b.mode="default",b.styleChoices=d.STYLES,b.styleChosen=b.styleChoices[0],b.$watch("mode",function(){if("default"===b.mode&&g(),"delete"===b.mode&&(g(),$("#der").css("cursor","crosshair"),d3.selectAll("path").on("click",function(){this.remove()}),d3.selectAll("text").on("click",function(){this.remove()})),"point"===b.mode&&(g(),$("#der").css("cursor","crosshair"),b.styleChoices=d.STYLES[b.mode],b.styleChosen=b.styleChoices[0],d3.select("svg").on("click",function(){var a=d3.mouse(this);d3.select("svg").append("path").style("stroke","gray").style("fill","black").attr("d",b.styleChosen.path(a[0],a[1],b.styleChosen.radius))})),"line"===b.mode||"polygon"===b.mode){g(),$("#der").css("cursor","crosshair"),b.styleChoices=d.STYLES[b.mode],b.styleChosen=b.styleChoices[0];var a=[],c=null,e=d3.svg.line().x(function(a){return a[0]}).y(function(a){return a[1]}).interpolate("linear");d3.select("svg").on("click",function(){var d;d3.select(".edition")[0][0]?d=d3.select(".edition"):(a=[],d=d3.select("svg").append("path").attr({"class":"edition"}),angular.forEach(b.styleChosen.style,function(a){d.attr(a.k,a.v)}));var f=d3.mouse(this);c=f,a.push(f),d.attr({d:e(a)})}).on("dblclick",function(){if("polygon"===b.mode){var a=d3.select(".edition").attr("d");d3.select(".edition").attr({d:a+"Z"})}d3.select(".edition").classed("edition",!1),d3.select(".ongoing").remove(),c=null}).on("mousemove",function(){if(c){var a;d3.select(".ongoing")[0][0]?a=d3.select(".ongoing"):(a=d3.select("svg").append("line").attr({"class":"ongoing"}),angular.forEach(b.styleChosen.style,function(b){a.attr(b.k,b.v)}));var d=d3.mouse(this);a.attr("x1",c[0]).attr("y1",c[1]).attr("x2",d[0]).attr("y2",d[1])}})}"addtext"===b.mode&&(g(),$("#der").css("cursor","crosshair"),d3.select("svg").on("click",function(){d3.select(".braille.edition").classed("edition",!1);var a=d3.mouse(this);d3.select("svg").append("text").attr("x",a[0]).attr("y",a[1]).attr("font-size","20px").attr({"class":"braille edition"}).text(""),d3.select("body").on("keydown",function(){window.onkeydown=function(a){return 32!==a.keyCode};var a=String.fromCharCode(d3.event.keyCode).toLowerCase(),b=d3.select(".braille.edition").text()+a;d3.select(".braille.edition").text(b)})}))}),b.mapExport=e.mapExport}]),angular.module("accessimapEditeurDerApp").service("shareSvg",["$q",function(a){var b,c=function(c){var d=a.defer();return b=c,d.resolve(),d.promise},d=function(){var c=a.defer();return c.resolve(b),c.promise};return{addSvg:c,getSvg:d}}]),angular.module("accessimapEditeurDerApp").service("editSvg",function(){this.circlePath=function(a,b,c){var d="M "+a+" "+b;return d+=" m -"+c+", 0",d+=" a "+c+","+c+" 0 1,0 "+2*c+",0",d+=" a "+c+","+c+" 0 1,0 -"+2*c+",0"}});