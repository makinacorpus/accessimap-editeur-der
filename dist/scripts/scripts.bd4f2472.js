d3.geo.tile=function(){function a(){var a=Math.max(Math.log(c)/Math.LN2-8,0),f=Math.round(a+e),g=Math.pow(2,a-f+8),h=[(d[0]-c/2)/g,(d[1]-c/2)/g],i=[],j=d3.range(Math.max(0,Math.floor(-h[0])),Math.max(0,Math.ceil(b[0]/g-h[0]))),k=d3.range(Math.max(0,Math.floor(-h[1])),Math.max(0,Math.ceil(b[1]/g-h[1])));return k.forEach(function(a){j.forEach(function(b){i.push([b,a,f])})}),i.translate=h,i.scale=g,i}var b=[960,500],c=256,d=[b[0]/2,b[1]/2],e=0;return a.size=function(c){return arguments.length?(b=c,a):b},a.scale=function(b){return arguments.length?(c=b,a):c},a.translate=function(b){return arguments.length?(d=b,a):d},a.zoomDelta=function(b){return arguments.length?(e=+b,a):e},a},!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.osmtogeojson=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./lodash.custom.js"),d=a("geojson-rewind"),e=a("./polygon_features.json"),f={};f=function(a,b){function f(a){function b(a){var b=c.clone(a);b.lat=a.center.lat,b.lon=a.center.lon,b.__is_center_placeholder=!0,g.push(b)}function d(a){function b(a,b,c){var e={type:"node",id:"_"+d.type+"/"+d.id+"bounds"+c,lat:a,lon:b};d.nodes.push(e.id),g.push(e)}var d=c.clone(a);d.nodes=[],b(d.bounds.minlat,d.bounds.minlon,1),b(d.bounds.maxlat,d.bounds.minlon,2),b(d.bounds.maxlat,d.bounds.maxlon,3),b(d.bounds.minlat,d.bounds.maxlon,4),d.nodes.push(d.nodes[0]),d.__is_bounds_placeholder=!0,i.push(d)}function e(a){function b(a,b,c){var d={type:"node",id:c,lat:a,lon:b};g.push(d)}c.isArray(a.nodes)||(a.nodes=a.geometry.map(function(a){return null!==a?"_anonymous@"+a.lat+"/"+a.lon:"_anonymous@unknown_location"})),a.geometry.forEach(function(c,d){c&&b(c.lat,c.lon,a.nodes[d])})}function f(a){function b(a,b,c){var d={type:"node",id:c,lat:a,lon:b};g.push(d)}function c(a,b){function c(a,b){var c={type:"node",id:"_anonymous@"+a+"/"+b,lat:a,lon:b};d.nodes.push(c.id),g.push(c)}if(!i.some(function(a){return"way"==a.type&&a.id==b})){var d={type:"way",id:b,nodes:[]};a.forEach(function(a){a?c(a.lat,a.lon):d.nodes.push(void 0)}),i.push(d)}}a.members.forEach(function(a){"node"==a.type?a.lat&&b(a.lat,a.lon,a.ref):"way"==a.type&&a.geometry&&c(a.geometry,a.ref)})}for(var g=new Array,i=new Array,j=new Array,k=0;k<a.elements.length;k++)switch(a.elements[k].type){case"node":var l=a.elements[k];g.push(l);break;case"way":var m=c.clone(a.elements[k]);m.nodes=c.clone(m.nodes),i.push(m),m.center&&b(m),m.geometry?e(m):m.bounds&&d(m);break;case"relation":var n=c.clone(a.elements[k]);n.members=c.clone(n.members),j.push(n);var o=n.members&&n.members.some(function(a){return"node"==a.type&&a.lat||"way"==a.type&&a.geometry});n.center&&b(n),o?f(n):n.bounds&&d(n)}return h(g,i,j)}function g(a){function b(a,b,c){a.hasAttribute(c)&&(b[c]=a.getAttribute(c))}function d(a,d){var e=c.clone(a);b(d,e,"lat"),b(d,e,"lon"),e.__is_center_placeholder=!0,i.push(e)}function e(a,b){function d(a,b,c){var d={type:"node",id:"_"+e.type+"/"+e.id+"bounds"+c,lat:a,lon:b};e.nodes.push(d.id),i.push(d)}var e=c.clone(a);e.nodes=[],d(b.getAttribute("minlat"),b.getAttribute("minlon"),1),d(b.getAttribute("maxlat"),b.getAttribute("minlon"),2),d(b.getAttribute("maxlat"),b.getAttribute("maxlon"),3),d(b.getAttribute("minlat"),b.getAttribute("maxlon"),4),e.nodes.push(e.nodes[0]),e.__is_bounds_placeholder=!0,j.push(e)}function f(a,b){function d(a,b,c){var d={type:"node",id:c,lat:a,lon:b};return i.push(d),d.id}c.isArray(a.nodes)||(a.nodes=[],c.each(b,function(b){a.nodes.push("_anonymous@"+b.getAttribute("lat")+"/"+b.getAttribute("lon"))})),c.each(b,function(b,c){b.getAttribute("lat")&&d(b.getAttribute("lat"),b.getAttribute("lon"),a.nodes[c])})}function g(a,b){function d(a,b,c){var d={type:"node",id:c,lat:a,lon:b};i.push(d)}function e(a,b){function d(a,b){var c={type:"node",id:"_anonymous@"+a+"/"+b,lat:a,lon:b};e.nodes.push(c.id),i.push(c)}if(!j.some(function(a){return"way"==a.type&&a.id==b})){var e={type:"way",id:b,nodes:[]};c.each(a,function(a){a.getAttribute("lat")?d(a.getAttribute("lat"),a.getAttribute("lon")):e.nodes.push(void 0)}),j.push(e)}}c.each(b,function(b,c){"node"==a.members[c].type?b.getAttribute("lat")&&d(b.getAttribute("lat"),b.getAttribute("lon"),a.members[c].ref):"way"==a.members[c].type&&b.getElementsByTagName("nd").length>0&&e(b.getElementsByTagName("nd"),a.members[c].ref)})}var i=new Array,j=new Array,k=new Array;c.each(a.getElementsByTagName("node"),function(a){var d={};c.each(a.getElementsByTagName("tag"),function(a){d[a.getAttribute("k")]=a.getAttribute("v")});var e={type:"node"};b(a,e,"id"),b(a,e,"lat"),b(a,e,"lon"),b(a,e,"version"),b(a,e,"timestamp"),b(a,e,"changeset"),b(a,e,"uid"),b(a,e,"user"),c.isEmpty(d)||(e.tags=d),i.push(e)});var l,m;return c.each(a.getElementsByTagName("way"),function(a){var g={},h=[];c.each(a.getElementsByTagName("tag"),function(a){g[a.getAttribute("k")]=a.getAttribute("v")});var i=!1;c.each(a.getElementsByTagName("nd"),function(a,b){var c;(c=a.getAttribute("ref"))&&(h[b]=c),!i&&a.getAttribute("lat")&&(i=!0)});var k={type:"way"};b(a,k,"id"),b(a,k,"version"),b(a,k,"timestamp"),b(a,k,"changeset"),b(a,k,"uid"),b(a,k,"user"),h.length>0&&(k.nodes=h),c.isEmpty(g)||(k.tags=g),(l=a.getElementsByTagName("center")[0])&&d(k,l),i?f(k,a.getElementsByTagName("nd")):(m=a.getElementsByTagName("bounds")[0])&&e(k,m),j.push(k)}),c.each(a.getElementsByTagName("relation"),function(a){var f={},h=[];c.each(a.getElementsByTagName("tag"),function(a){f[a.getAttribute("k")]=a.getAttribute("v")});var i=!1;c.each(a.getElementsByTagName("member"),function(a,c){h[c]={},b(a,h[c],"ref"),b(a,h[c],"role"),b(a,h[c],"type"),(!i&&"node"==h[c].type&&a.getAttribute("lat")||"way"==h[c].type&&a.getElementsByTagName("nd").length>0)&&(i=!0)});var j={type:"relation"};b(a,j,"id"),b(a,j,"version"),b(a,j,"timestamp"),b(a,j,"changeset"),b(a,j,"uid"),b(a,j,"user"),h.length>0&&(j.members=h),c.isEmpty(f)||(j.tags=f),(l=a.getElementsByTagName("center")[0])&&d(j,l),i?g(j,a.getElementsByTagName("member")):(m=a.getElementsByTagName("bounds")[0])&&e(j,m),k.push(j)}),h(i,j,k)}function h(a,e,f){function g(a,c){if("object"!=typeof c&&(c={}),"function"==typeof b.uninterestingTags)return!b.uninterestingTags(a,c);for(var d in a)if(b.uninterestingTags[d]!==!0&&c[d]!==!0&&c[d]!==a[d])return!0;return!1}function h(a){var b={timestamp:a.timestamp,version:a.version,changeset:a.changeset,user:a.user,uid:a.uid};for(k in b)void 0===b[k]&&delete b[k];return b}function j(a,d){function e(c){for(var d,e,f,g,h,i,k=function(a){return a[0]},l=function(a){return a[a.length-1]},m=[];c.length;)for(d=c.pop().nodes.slice(),m.push(d);c.length&&k(d)!==l(d);){for(e=k(d),f=l(d),g=0;g<c.length;g++){if(i=c[g].nodes,f===k(i)){h=d.push,i=i.slice(1);break}if(f===l(i)){h=d.push,i=i.slice(0,-1).reverse();break}if(e==l(i)){h=d.unshift,i=i.slice(0,-1);break}if(e==k(i)){h=d.unshift,i=i.slice(1).reverse();break}i=h=null}if(!i){b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains unclosed ring geometry");break}c.splice(g,1),h.apply(d,i)}return m}function f(a){var b,c,d=function(a,b){for(var c=0;c<b.length;c++)if(f(b[c],a))return!0;return!1},e=function(a){return a.map(function(a){return[+a.lat,+a.lon]})},f=function(a,b){for(var c=a[0],d=a[1],e=!1,f=0,g=b.length-1;f<b.length;g=f++){var h=b[f][0],i=b[f][1],j=b[g][0],k=b[g][1],l=i>d!=k>d&&(j-h)*(d-i)/(k-i)+h>c;l&&(e=!e)}return e};for(a=e(a),b=0;b<k.length;b++)if(c=e(k[b]),d(c,a))return b}var g,i=!1,j=D?"way":"relation";g=d.members.filter(function(a){return"way"===a.type}),g=g.map(function(c){var d=p[c.ref];return void 0===d?(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"tainted by a missing way",c.type+"/"+c.ref),void(i=!0)):{id:c.ref,role:c.role||"outer",way:d,nodes:d.nodes.filter(function(d){return void 0!==d?!0:(i=!0,b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"tainted by a way",c.type+"/"+c.ref,"with a missing node"),!1)})}}),g=c.compact(g);var k,l;k=e(g.filter(function(a){return"outer"===a.role})),l=e(g.filter(function(a){return"inner"===a.role}));var m;m=k.map(function(a){return[a]});for(var n=0;n<l.length;n++){var o=f(l[n]);void 0!==o?m[o].push(l[n]):b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains an inner ring with no containing outer")}var q=[];if(q=c.compact(m.map(function(d){var e=c.compact(d.map(function(d){return d.length<4?void(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains a ring with less than four nodes")):c.compact(d.map(function(a){return[+a.lon,+a.lat]}))}));return 0==e.length?void(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains an empty ring cluster")):e})),0==q.length)return b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"contains no coordinates"),!1;var r="MultiPolygon";1===q.length&&(r="Polygon",q=q[0]);var s={type:"Feature",id:a.type+"/"+a.id,properties:{type:a.type,id:a.id,tags:a.tags||{},relations:t[a.type][a.id]||[],meta:h(a)},geometry:{type:r,coordinates:q}};return i&&(b.verbose&&console.warn("Multipolygon",j+"/"+a.id,"is tainted"),s.properties.tainted=!0),s}for(var l=new Object,m=0;m<a.length;m++)void 0!==a[m].lat?l[a[m].id]=a[m]:b.verbose&&console.warn("Node",a[m].type+"/"+a[m].id,"ignored because it has no coordinates");for(var n=new Object,m=0;m<a.length;m++)"undefined"!=typeof a[m].tags&&g(a[m].tags)&&(n[a[m].id]=!0);for(var m=0;m<f.length;m++)if(c.isArray(f[m].members))for(var o=0;o<f[m].members.length;o++)"node"==f[m].members[o].type&&(n[f[m].members[o].ref]=!0);else b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"ignored because it has no members");for(var p=new Object,q=new Object,m=0;m<e.length;m++)if(c.isArray(e[m].nodes)){p[e[m].id]=e[m];for(var o=0;o<e[m].nodes.length;o++)q[e[m].nodes[o]]=!0,e[m].nodes[o]=l[e[m].nodes[o]]}else b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"ignored because it has no nodes");for(var r=new Array,m=0;m<a.length;m++)(!q[a[m].id]||n[a[m].id])&&r.push(a[m]);for(var s=new Array,m=0;m<f.length;m++)c.isArray(f[m].members)?s[f[m].id]=f[m]:b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"ignored because it has no members");for(var t={node:{},way:{},relation:{}},m=0;m<f.length;m++)if(c.isArray(f[m].members))for(var o=0;o<f[m].members.length;o++){var u;switch(f[m].members[o].type){case"node":u=l[f[m].members[o].ref];break;case"way":u=p[f[m].members[o].ref];break;case"relation":u=s[f[m].members[o].ref]}if(u){var v=f[m].members[o].type,w=f[m].members[o].ref;"undefined"==typeof t[v][w]&&(t[v][w]=[]),t[v][w].push({role:f[m].members[o].role,rel:f[m].id,reltags:f[m].tags})}else b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"member",f[m].members[o].type+"/"+f[m].members[o].id,"ignored because it has an invalid type")}else b.verbose&&console.warn("Relation",f[m].type+"/"+f[m].id,"ignored because it has no members");var x,y={type:"FeatureCollection",features:new Array};for(m=0;m<r.length;m++)if("undefined"!=typeof r[m].lon&&"undefined"!=typeof r[m].lat){var z={type:"Feature",id:r[m].type+"/"+r[m].id,properties:{type:r[m].type,id:r[m].id,tags:r[m].tags||{},relations:t.node[r[m].id]||[],meta:h(r[m])},geometry:{type:"Point",coordinates:[+r[m].lon,+r[m].lat]}};r[m].__is_center_placeholder&&(z.properties.geometry="center"),y.features.push(z)}else b.verbose&&console.warn("POI",r[m].type+"/"+r[m].id,"ignored because it lacks coordinates");for(var A={type:"FeatureCollection",features:new Array},B={type:"FeatureCollection",features:new Array},m=0;m<f.length;m++)if("undefined"!=typeof f[m].tags&&("multipolygon"==f[m].tags.type||"boundary"==f[m].tags.type)){if(!c.isArray(f[m].members)){b.verbose&&console.warn("Multipolygon",f[m].type+"/"+f[m].id,"ignored because it has no members");continue}for(var C=0,o=0;o<f[m].members.length;o++)"outer"==f[m].members[o].role?C++:b.verbose&&"inner"!=f[m].members[o].role&&console.warn("Multipolygon",f[m].type+"/"+f[m].id,"member",f[m].members[o].type+"/"+f[m].members[o].ref,'ignored because it has an invalid role: "'+f[m].members[o].role+'"');if(f[m].members.forEach(function(a){p[a.ref]&&("outer"!==a.role||g(p[a.ref].tags,f[m].tags)||(p[a.ref].is_multipolygon_outline=!0),"inner"!==a.role||g(p[a.ref].tags)||(p[a.ref].is_multipolygon_outline=!0))}),0==C){b.verbose&&console.warn("Multipolygon relation",f[m].type+"/"+f[m].id,"ignored because it has no outer ways");continue}var D=!1;1!=C||g(f[m].tags,{type:!0})||(D=!0);var z=null;if(D){var E=f[m].members.filter(function(a){return"outer"===a.role})[0];if(E=p[E.ref],void 0===E){b.verbose&&console.warn("Multipolygon relation",f[m].type+"/"+f[m].id,"ignored because outer way",E.type+"/"+E.ref,"is missing");continue}E.is_multipolygon_outline=!0,z=j(E,f[m])}else z=j(f[m],f[m]);if(z===!1){b.verbose&&console.warn("Multipolygon relation",f[m].type+"/"+f[m].id,"ignored because it has invalid geometry");continue}B.features.push(z)}for(var m=0;m<e.length;m++)if(c.isArray(e[m].nodes)){if(!e[m].is_multipolygon_outline){for(e[m].tainted=!1,e[m].hidden=!1,coords=new Array,o=0;o<e[m].nodes.length;o++)"object"==typeof e[m].nodes[o]?coords.push([+e[m].nodes[o].lon,+e[m].nodes[o].lat]):(b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"is tainted by an invalid node"),e[m].tainted=!0);if(coords.length<=1)b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"ignored because it contains too few nodes");else{var F="LineString";"undefined"!=typeof e[m].nodes[0]&&e[m].nodes[0]===e[m].nodes[e[m].nodes.length-1]&&("undefined"!=typeof e[m].tags&&i(e[m].tags)||e[m].__is_bounds_placeholder)&&(F="Polygon",coords=[coords]);var z={type:"Feature",id:e[m].type+"/"+e[m].id,properties:{type:e[m].type,id:e[m].id,tags:e[m].tags||{},relations:t.way[e[m].id]||[],meta:h(e[m])},geometry:{type:F,coordinates:coords}};e[m].tainted&&(b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"is tainted"),z.properties.tainted=!0),e[m].__is_bounds_placeholder&&(z.properties.geometry="bounds"),"LineString"==F?A.features.push(z):B.features.push(z)}}}else b.verbose&&console.warn("Way",e[m].type+"/"+e[m].id,"ignored because it has no nodes");return x={type:"FeatureCollection",features:[]},x.features=x.features.concat(B.features),x.features=x.features.concat(A.features),x.features=x.features.concat(y.features),b.flatProperties&&x.features.forEach(function(a){a.properties=c.merge(a.properties.meta,a.properties.tags,{id:a.properties.type+"/"+a.properties.id})}),x=d(x,!0)}function i(a){var c=b.polygonFeatures;if("function"==typeof c)return c(a);if("no"===a.area)return!1;for(var d in a){var e=a[d],f=c[d];if("undefined"!=typeof f&&"no"!==e){if(f===!0)return!0;if(f.included_values&&f.included_values[e]===!0)return!0;if(f.excluded_values&&f.excluded_values[e]!==!0)return!0}}return!1}b=c.merge({verbose:!1,flatProperties:!1,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:e},b);var j;return j="undefined"!=typeof XMLDocument&&a instanceof XMLDocument||"undefined"==typeof XMLDocument&&a.childNodes?g(a):f(a)},f.toGeojson=f,b.exports=f},{"./lodash.custom.js":2,"./polygon_features.json":6,"geojson-rewind":3}],2:[function(a,b,c){(function(a){(function(){function d(){return F.pop()||[]}function e(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function f(a){a.length=0,F.length<H&&F.push(a)}function g(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function h(){}function i(a){function b(){if(d){var a=g(d);mb.apply(a,arguments)}if(this instanceof b){var f=l(c.prototype),h=c.apply(f,a||arguments);return x(h)?h:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return xb(b,a),b}function j(a,b,c,h,i){if(c){var k=c(a);if("undefined"!=typeof k)return k}var l=x(a);if(!l)return a;var m=hb.call(a);if(!W[m]||!vb.nodeClass&&e(a))return a;var n=tb[m];switch(m){case O:case P:return new n(+a);case S:case V:return new n(a);case U:return k=n(a.source,I.exec(a)),k.lastIndex=a.lastIndex,k}var o=yb(a);if(b){var p=!h;h||(h=d()),i||(i=d());for(var q=h.length;q--;)if(h[q]==a)return i[q];k=o?n(a.length):{}}else k=o?g(a):Fb({},a);return o&&(lb.call(a,"index")&&(k.index=a.index),lb.call(a,"input")&&(k.input=a.input)),b?(h.push(a),i.push(k),(o?Eb:Hb)(a,function(a,d){k[d]=j(a,b,c,h,i)}),p&&(f(h),f(i)),k):k}function l(a){return x(a)?qb(a):{}}function m(a,b,c){if("function"!=typeof a)return D;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(vb.funcNames&&(d=!a.name),d=d||!vb.funcDecomp,!d)){var e=jb.call(a);vb.funcNames||(d=!J.test(e)),d||(d=K.test(e),xb(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return C(a,b)}function n(a){function b(){var a=j?h:this;if(e){var q=g(e);mb.apply(q,arguments)}if((f||m)&&(q||(q=g(arguments)),f&&mb.apply(q,f),m&&q.length<i))return d|=16,n([c,o?d:-4&d,q,null,h,i]);if(q||(q=arguments),k&&(c=a[p]),this instanceof b){a=l(c.prototype);var r=c.apply(a,q);return x(r)?r:a}return c.apply(a,q)}var c=a[0],d=a[1],e=a[2],f=a[3],h=a[4],i=a[5],j=1&d,k=2&d,m=4&d,o=8&d,p=c;return xb(b,a),b}function o(a,b,c,d,e){(yb(b)?A:Hb)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=yb(b))||Ib(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?yb(j)?j:[]:Ib(j)?j:{}),d.push(b),e.push(j),l||o(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function p(a,b,c,d,e,f){var h=1&b,j=2&b,k=4&b,l=16&b,m=32&b;if(!j&&!w(a))throw new TypeError;l&&!c.length&&(b&=-17,l=c=!1),m&&!d.length&&(b&=-33,m=d=!1);var o=a&&a.__bindData__;if(o&&o!==!0)return o=g(o),o[2]&&(o[2]=g(o[2])),o[3]&&(o[3]=g(o[3])),!h||1&o[1]||(o[4]=e),!h&&1&o[1]&&(b|=8),!k||4&o[1]||(o[5]=f),l&&mb.apply(o[2]||(o[2]=[]),c),m&&ob.apply(o[3]||(o[3]=[]),d),o[1]|=b,p.apply(null,o);var q=1==b||17===b?i:n;return q([a,b,c,d,e,f])}function q(){Y.shadowedProps=L,Y.array=Y.bottom=Y.loop=Y.top="",Y.init="iterable",Y.useHas=!0;for(var a,b=0;a=arguments[b];b++)for(var c in a)Y[c]=a[c];var d=Y.args;Y.firstArg=/^[^,]+/.exec(d)[0];var e=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+d+") {\n"+wb(Y)+"\n}");return e(m,Q,eb,lb,G,t,yb,y,Y.keys,fb,Z,ub,V,gb,hb)}function r(a){return"function"==typeof a&&ib.test(a)}function s(a){var b,c;return!a||hb.call(a)!=T||(b=a.constructor,w(b)&&!(b instanceof b))||!vb.argsClass&&t(a)||!vb.nodeClass&&e(a)?!1:vb.ownLast?(Gb(a,function(a,b,d){return c=lb.call(d,b),!1}),c!==!1):(Gb(a,function(a,b){c=b}),"undefined"==typeof c||lb.call(a,c))}function t(a){return a&&"object"==typeof a&&"number"==typeof a.length&&hb.call(a)==M||!1}function u(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),j(a,b,"function"==typeof c&&m(c,d,1))}function v(a){var b=!0;if(!a)return b;var c=hb.call(a),d=a.length;return c==N||c==V||(vb.argsClass?c==M:t(a))||c==T&&"number"==typeof d&&w(a.splice)?!d:(Hb(a,function(){return b=!1}),b)}function w(a){return"function"==typeof a}function x(a){return!(!a||!Z[typeof a])}function y(a){return"string"==typeof a||a&&"object"==typeof a&&hb.call(a)==V||!1}function z(a){var b=arguments,c=2;if(!x(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var e=m(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(e=b[--c]);for(var h=g(arguments,1,c),i=-1,j=d(),k=d();++i<c;)o(a,h[i],e,j,k);return f(j),f(k),a}function A(a,b,c){if(b&&"undefined"==typeof c&&yb(a))for(var d=-1,e=a.length;++d<e&&b(a[d],d,a)!==!1;);else Eb(a,b,c);return a}function B(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function C(a,b){return arguments.length>2?p(a,17,g(arguments,2),null,b):p(a,1,null,null,b)}function D(a){return a}function E(){}var F=[],G={},H=40,I=/\w*$/,J=/^\s*function[ \n\r\t]+\w/,K=/\bthis\b/,L=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],M="[object Arguments]",N="[object Array]",O="[object Boolean]",P="[object Date]",Q="[object Error]",R="[object Function]",S="[object Number]",T="[object Object]",U="[object RegExp]",V="[object String]",W={};W[R]=!1,W[M]=W[N]=W[O]=W[P]=W[S]=W[T]=W[U]=W[V]=!0;var X={configurable:!1,enumerable:!1,value:null,writable:!1},Y={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},Z={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},$=Z[typeof window]&&window||this,_=Z[typeof c]&&c&&!c.nodeType&&c,ab=Z[typeof b]&&b&&!b.nodeType&&b,bb=ab&&ab.exports===_&&_,cb=Z[typeof a]&&a;!cb||cb.global!==cb&&cb.window!==cb||($=cb);var db=[],eb=Error.prototype,fb=Object.prototype,gb=String.prototype,hb=fb.toString,ib=RegExp("^"+String(hb).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),jb=Function.prototype.toString,kb=r(kb=Object.getPrototypeOf)&&kb,lb=fb.hasOwnProperty,mb=db.push,nb=fb.propertyIsEnumerable,ob=db.unshift,pb=function(){try{var a={},b=r(b=Object.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),qb=r(qb=Object.create)&&qb,rb=r(rb=Array.isArray)&&rb,sb=r(sb=Object.keys)&&sb,tb={};tb[N]=Array,tb[O]=Boolean,tb[P]=Date,tb[R]=Function,tb[T]=Object,tb[S]=Number,tb[U]=RegExp,tb[V]=String;var ub={};ub[N]=ub[P]=ub[S]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ub[O]=ub[V]={constructor:!0,toString:!0,valueOf:!0},ub[Q]=ub[R]=ub[U]={constructor:!0,toString:!0},ub[T]={constructor:!0},function(){for(var a=L.length;a--;){var b=L[a];for(var c in ub)lb.call(ub,c)&&!lb.call(ub[c],b)&&(ub[c][b]=!1)}}();var vb=h.support={};!function(){var a=function(){this.x=1},b={0:1,length:1},c=[];a.prototype={valueOf:1,y:1};for(var d in new a)c.push(d);for(d in arguments);vb.argsClass=hb.call(arguments)==M,vb.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),vb.enumErrorProps=nb.call(eb,"message")||nb.call(eb,"name"),vb.enumPrototypes=nb.call(a,"prototype"),vb.funcDecomp=!r($.WinRTError)&&K.test(function(){return this}),vb.funcNames="string"==typeof Function.name,vb.nonEnumArgs=0!=d,vb.nonEnumShadows=!/valueOf/.test(c),vb.ownLast="x"!=c[0],vb.spliceObjects=(db.splice.call(b,0,1),!b[0]),vb.unindexedChars="x"[0]+Object("x")[0]!="xx";try{vb.nodeClass=!(hb.call(document)==T&&!({toString:0}+""))}catch(e){vb.nodeClass=!0}}(1);var wb=function(a){var b="var index, iterable = "+a.firstArg+", result = "+a.init+";\nif (!iterable) return result;\n"+a.top+";";a.array?(b+="\nvar length = iterable.length; index = -1;\nif ("+a.array+") {  ",vb.unindexedChars&&(b+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),b+="\n  while (++index < length) {\n    "+a.loop+";\n  }\n}\nelse {  "):vb.nonEnumArgs&&(b+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+a.loop+";\n    }\n  } else {  "),vb.enumPrototypes&&(b+="\n  var skipProto = typeof iterable == 'function';\n  "),vb.enumErrorProps&&(b+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var c=[];if(vb.enumPrototypes&&c.push('!(skipProto && index == "prototype")'),vb.enumErrorProps&&c.push('!(skipErrorProps && (index == "message" || index == "name"))'),a.useHas&&a.keys)b+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }  ";else if(b+="\n  for (index in iterable) {\n",a.useHas&&c.push("hasOwnProperty.call(iterable, index)"),c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }    ",vb.nonEnumShadows){for(b+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)b+="\n    index = '"+a.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",a.useHas||(b+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),b+=") {\n      "+a.loop+";\n    }      ";b+="\n  }    "}return(a.array||vb.nonEnumArgs)&&(b+="\n}"),b+=a.bottom+";\nreturn result"};qb||(l=function(){function a(){}return function(b){if(x(b)){a.prototype=b;var c=new a;a.prototype=null}return c||$.Object()}}());var xb=pb?function(a,b){X.value=b,pb(a,"__bindData__",X)}:E;vb.argsClass||(t=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&lb.call(a,"callee")&&!nb.call(a,"callee")||!1});var yb=rb||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&hb.call(a)==N||!1},zb=q({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Ab=sb?function(a){return x(a)?vb.enumPrototypes&&"function"==typeof a||vb.nonEnumArgs&&a.length&&t(a)?zb(a):sb(a):[]}:zb,Bb={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:Ab,loop:"if (callback(iterable[index], index, collection) === false) return result"},Cb={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:Ab,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Db={top:"if (!objectTypes[typeof iterable]) return result;\n"+Bb.top,array:!1},Eb=q(Bb),Fb=q(Cb,{top:Cb.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Gb=q(Bb,Db,{useHas:!1}),Hb=q(Bb,Db);w(/x/)&&(w=function(a){return"function"==typeof a&&hb.call(a)==R});var Ib=kb?function(a){if(!a||hb.call(a)!=T||!vb.argsClass&&t(a))return!1;var b=a.valueOf,c=r(b)&&(c=kb(b))&&kb(c);return c?a==c||kb(a)==c:s(a)}:s;h.assign=Fb,h.bind=C,h.compact=B,h.forEach=A,h.forIn=Gb,h.forOwn=Hb,h.keys=Ab,h.merge=z,h.each=A,h.extend=Fb,h.clone=u,h.identity=D,h.isArguments=t,h.isArray=yb,h.isEmpty=v,h.isFunction=w,h.isObject=x,h.isPlainObject=Ib,h.isString=y,h.noop=E,h.VERSION="2.4.1",_&&ab&&bb&&((ab.exports=h)._=h)}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b){function c(a,b){switch(a&&a.type||null){case"FeatureCollection":return a.features=a.features.map(d(c,b)),a;case"Feature":return a.geometry=c(a.geometry,b),a;case"Polygon":case"MultiPolygon":return e(a,b);default:return a}}function d(a,b){return function(c){return a(c,b)}}function e(a,b){return"Polygon"===a.type?a.coordinates=f(a.coordinates,b):"MultiPolygon"===a.type&&(a.coordinates=a.coordinates.map(d(f,b))),a}function f(a,b){b=!!b,a[0]=g(a[0],!b);for(var c=1;c<a.length;c++)a[c]=g(a[c],b);return a}function g(a,b){return h(a)===b?a:a.reverse()}function h(a){return i.ring(a)>=0}var i=a("geojson-area");b.exports=c},{"geojson-area":4}],4:[function(a,b){function c(a){if("Polygon"===a.type)return d(a.coordinates);if("MultiPolygon"===a.type){for(var b=0,c=0;c<a.coordinates.length;c++)b+=d(a.coordinates[c]);return b}return null}function d(a){var b=0;if(a&&a.length>0){b+=Math.abs(e(a[0]));for(var c=1;c<a.length;c++)b-=Math.abs(e(a[c]))}return b}function e(a){var b=0;if(a.length>2){for(var c,d,e=0;e<a.length-1;e++)c=a[e],d=a[e+1],b+=f(d[0]-c[0])*(2+Math.sin(f(c[1]))+Math.sin(f(d[1])));b=b*g.RADIUS*g.RADIUS/2}return b}function f(a){return a*Math.PI/180}var g=a("wgs84");b.exports.geometry=c,b.exports.ring=e},{wgs84:5}],5:[function(a,b){b.exports.RADIUS=6378137,b.exports.FLATTENING=1/298.257223563,b.exports.POLAR_RADIUS=6356752.3142},{}],6:[function(a,b){b.exports={building:!0,highway:{included_values:{services:!0,rest_area:!0,escape:!0}},natural:{excluded_values:{coastline:!0,ridge:!0,arete:!0,tree_row:!0}},landuse:!0,waterway:{included_values:{riverbank:!0,dock:!0,boatyard:!0,dam:!0}},amenity:!0,leisure:!0,barrier:{included_values:{city_wall:!0,ditch:!0,hedge:!0,retaining_wall:!0,wall:!0,spikes:!0}},railway:{included_values:{station:!0,turntable:!0,roundhouse:!0,platform:!0}},area:!0,boundary:!0,man_made:{excluded_values:{cutline:!0,embankment:!0,pipeline:!0}},power:{included_values:{plant:!0,substation:!0,generator:!0,transformer:!0}},place:!0,shop:!0,aeroway:{excluded_values:{taxiway:!0}},tourism:!0,historic:!0,public_transport:!0,office:!0,"building:part":!0,military:!0,ruins:!0,"area:highway":!0,craft:!0,golf:!0}},{}]},{},[1])(1)}),function(){var a,b,c=[].slice;a=function(){return(Math.random().toString(36)+"00000000000000000").replace(/[^a-z]+/g,"").slice(0,5)},(b=function(a){return"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define([],a):this.textures=a()})(function(){return{circles:function(){var b,c,d,e,f,g,h,i,j;return h=20,b="",g=2,d=!1,e="#343434",i="#343434",j=0,f=a(),c=function(){var a,c,k,l,m,n;if(c=this.append("defs").append("pattern").attr({id:f,patternUnits:"userSpaceOnUse",width:h,height:h}),b&&c.append("rect").attr({width:h,height:h,fill:b}),c.append("circle").attr({cx:h/2,cy:h/2,r:g,fill:e,stroke:i,"stroke-width":j}),d){for(m=[[0,0],[0,h],[h,0],[h,h]],n=[],k=0,l=m.length;l>k;k++)a=m[k],n.push(c.append("circle").attr({cx:a[0],cy:a[1],r:g,fill:e,stroke:i,"stroke-width":j}));return n}},c.heavier=function(a){return g=arguments.length&&a?2*g*a:2*g,c},c.lighter=function(a){return arguments.length?g=a?g/(2*a):g/2:g/=2,c},c.thinner=function(a){return h=arguments.length&&a?2*h*a:2*h,c},c.thicker=function(a){return arguments.length?h=a?h/(2*a):h/2:h/=2,c},c.background=function(a){return b=a,c},c.size=function(a){return h=a,c},c.complement=function(){return d=!0,c},c.radius=function(a){return g=a,c},c.fill=function(a){return e=a,c},c.stroke=function(a){return i=a,c},c.strokeWidth=function(a){return j=a,c},c.id=function(a){return arguments.length?(f=a,c):f},c.url=function(){return"url(#"+f+")"},c},lines:function(){var b,d,e,f,g,h,i,j,k;return i=20,k=2,j="#343434",d=a(),b="",f=["diagonal"],h="auto",g=function(a){switch(a){case"0/8":return function(a){return"M "+a/2+", 0 l 0, "+a}(i);case"vertical":return function(a){return"M "+a/2+", 0 l 0, "+a}(i);case"1/8":return function(a){return"M "+a/4+",0 l "+a/2+","+a+" M "+-a/4+",0 l "+a/2+","+a+"\nM "+3*a/4+",0 l "+a/2+","+a}(i);case"2/8":return function(a){return"M 0,"+a+" l "+a+","+-a+" M "+-a/4+","+a/4+" l "+a/2+","+-a/2+"\nM "+.75*a+","+5/4*a+" l "+a/2+","+-a/2}(i);case"diagonal":return function(a){return"M 0,"+a+" l "+a+","+-a+" M "+-a/4+","+a/4+" l "+a/2+","+-a/2+"\nM "+.75*a+","+5/4*a+" l "+a/2+","+-a/2}(i);case"3/8":return function(a){return"M 0,"+.75*a+" l "+a+","+-a/2+" M 0,"+a/4+" l "+a+","+-a/2+"\nM 0,"+5*a/4+" l "+a+","+-a/2
}(i);case"4/8":return function(a){return"M 0,"+a/2+" l "+a+",0"}(i);case"horizontal":return function(a){return"M 0,"+a/2+" l "+a+",0"}(i);case"5/8":return function(a){return"M 0,"+-a/4+" l "+a+","+a/2+"M 0,"+a/4+" l "+a+","+a/2+"\nM 0,"+3*a/4+" l "+a+","+a/2}(i);case"6/8":return function(a){return"M 0,0 l "+a+","+a+" M "+-a/4+","+.75*a+" l "+a/2+","+a/2+"\nM "+3*a/4+","+-a/4+" l "+a/2+","+a/2}(i);case"7/8":return function(a){return"M "+-a/4+",0 l "+a/2+","+a+" M "+a/4+",0 l "+a/2+","+a+"\nM "+3*a/4+",0 l "+a/2+","+a}(i);default:return function(a){return"M "+a/2+", 0 l 0, "+a}(i)}},e=function(){var a,c,e,l,m;for(a=this.append("defs").append("pattern").attr({id:d,patternUnits:"userSpaceOnUse",width:i,height:i}),b&&a.append("rect").attr({width:i,height:i,fill:b}),m=[],c=0,e=f.length;e>c;c++)l=f[c],m.push(a.append("path").attr({d:g(l),"stroke-width":k,"shape-rendering":h,stroke:j,"stroke-linecap":"square"}));return m},e.background=function(a){return b=a,e},e.shapeRendering=function(a){return h=a,e},e.heavier=function(a){return k=arguments.length&&a?2*k*a:2*k,e},e.lighter=function(a){return arguments.length?k=a?k/(2*a):k/2:k/=2,e},e.thinner=function(a){return i=arguments.length&&a?2*i*a:2*i,e},e.thicker=function(a){return arguments.length?i=a?i/(2*a):i/2:i/=2,e},e.orientation=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],f=a,e},e.size=function(a){return i=a,e},e.stroke=function(a){return j=a,e},e.strokeWidth=function(a){return k=a,e},e.id=function(a){return arguments.length?(d=a,e):d},e.url=function(){return"url(#"+d+")"},e},paths:function(){var b,c,d,e,f,g,h,i,j,k,l,m;return i=20,e=1,m=1,k=2,j="#343434",b="",c="",h="auto",d="transparent",f=a(),l=function(a){switch(a){case"squares":return function(a){return"M "+a/4+" "+a/4+" l "+a/2+" 0 l 0 "+a/2+" l "+-a/2+" 0 Z"}(i);case"nylon":return function(a){return"M 0 "+a/4+" l "+a/4+" 0 l 0 "+-a/4+" M "+3*a/4+" "+a+" l 0 "+-a/4+"\nl "+a/4+" 0 M "+a/4+" "+a/2+" l 0 "+a/4+" l "+a/4+" 0 M "+a/2+" "+a/4+"\nl "+a/4+" 0 l 0 "+a/4}(i);case"waves":return function(a){return"M 0 "+a/2+" c "+a/8+" "+-a/4+" , "+3*a/8+" "+-a/4+" , "+a/2+" 0\nc "+a/8+" "+a/4+" , "+3*a/8+" "+a/4+" , "+a/2+" 0 M "+-a/2+" "+a/2+"\nc "+a/8+" "+a/4+" , "+3*a/8+" "+a/4+" , "+a/2+" 0 M "+a+" "+a/2+"\nc "+a/8+" "+-a/4+" , "+3*a/8+" "+-a/4+" , "+a/2+" 0"}(i);case"woven":return function(a){return"M "+a/4+","+a/4+"l"+a/2+","+a/2+"M"+3*a/4+","+a/4+"l"+a/2+","+-a/2+"\nM"+a/4+","+3*a/4+"l"+-a/2+","+a/2+"M"+3*a/4+","+5*a/4+"l"+a/2+","+-a/2+"\nM"+-a/4+","+a/4+"l"+a/2+","+-a/2}(i);case"crosses":return function(a){return"M "+a/4+","+a/4+"l"+a/2+","+a/2+"M"+a/4+","+3*a/4+"l"+a/2+","+-a/2}(i);case"caps":return function(a){return"M "+a/4+","+3*a/4+"l"+a/4+","+-a/2+"l"+a/4+","+a/2}(i);case"hexagons":return function(a){return m=3,e=Math.sqrt(3),"M "+a+",0 l "+a+",0 l "+a/2+","+a*Math.sqrt(3)/2+"\nl "+-a/2+","+a*Math.sqrt(3)/2+" l "+-a+",0\nl "+-a/2+","+-a*Math.sqrt(3)/2+" Z M 0,"+a*Math.sqrt(3)/2+"\nl "+a/2+",0 M "+3*a+","+a*Math.sqrt(3)/2+" l "+-a/2+",0"}(i);default:return a(i)}},g=function(){var a,g;return g=l(c),a=this.append("defs").append("pattern").attr({id:f,patternUnits:"userSpaceOnUse",width:i*m,height:i*e}),b&&a.append("rect").attr({width:i*m,height:i*e,fill:b}),a.append("path").attr({d:g,fill:d,"stroke-width":k,"shape-rendering":h,stroke:j,"stroke-linecap":"square"})},g.background=function(a){return b=a,g},g.shapeRendering=function(a){return h=a,g},g.heavier=function(a){return k=arguments.length&&a?2*k*a:2*k,g},g.lighter=function(a){return arguments.length?k=a?k/(2*a):k/2:k/=2,g},g.thinner=function(a){return i=arguments.length&&a?2*i*a:2*i,g},g.thicker=function(a){return arguments.length?i=a?i/(2*a):i/2:i/=2,g},g.d=function(a){return c=a,g},g.size=function(a){return i=a,g},g.stroke=function(a){return j=a,g},g.strokeWidth=function(a){return k=a,g},g.id=function(a){return arguments.length?(f=a,g):f},g.url=function(){return"url(#"+f+")"},g}}})}.call(this),angular.module("accessimapEditeurDerApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angularSpinner","ui.select","ui.bootstrap-slider","ui.grid","ui.grid.edit","ui.grid.autoResize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/localmap",{templateUrl:"views/localmap.html",controller:"LocalmapCtrl"}).when("/globalmap",{templateUrl:"views/globalmap.html",controller:"GlobalmapCtrl"}).when("/commonmap",{templateUrl:"views/commonmap.html",controller:"CommonmapCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("accessimapEditeurDerApp").controller("MainCtrl",["$scope","$rootScope","$location","settings",function(a,b,c,d){a.go=function(b){c.path(b).search("mapFormat",a.mapFormat).search("legendFormat",a.legendFormat)},a.formats=d.FORMATS,a.mapFormat="landscapeA4",a.legendFormat="landscapeA4",b.iid=1,b.getiid=function(){return b.iid++}}]),angular.module("accessimapEditeurDerApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("accessimapEditeurDerApp").factory("settings",["editSvg",function(a){var b={GLOBAL_MAP_CENTER:[1.44,43.6],GLOBAL_MAP_DEFAULT_ZOOM:13},c=[{name:"Braille",size:"35px",family:"Braille_2007",weight:null,color:"black"},{name:"Arial gras 32",size:"32px",family:"Arial",weight:"bold",color:"other"},{name:"Arial gras 28",size:"28px",family:"Arial",weight:"bold",color:"other"},{name:"Arial gras 22",size:"22px",family:"Arial",weight:"bold",color:"other"},{name:"Arial gras 18",size:"18px",family:"Arial",weight:"bold",color:"other"}],d={black:[{name:"Noir",color:"black"}],other:[{name:"Bleu",color:"blue"},{name:"Rouge",color:"red"}]},e={portraitA4:{name:"A4 Portrait",width:210,height:297},landscapeA4:{name:"A4 Paysage",width:297,height:210},portraitA3:{name:"A3 Portrait",width:297,height:420},landscapeA3:{name:"A3 Paysage",width:420,height:297}},f=[{id:"poi",name:"Point d'intérêt",type:"point",query:['node["amenity"]','node["shop"]'],icon:"road"},{id:"trottoirs",name:"Trottoirs",type:"line",query:['way["footway"="sidewalk"]'],icon:"road"},{id:"ppietons",name:"Passages piétons",type:"line",query:['way["footway"="crossing"]'],icon:"road"},{id:"ppietonsp",name:"Passages piétons",type:"point",query:['node["highway"="crossing"]'],icon:"road"},{id:"principales",name:"Routes principales",type:"line",query:['way["highway"~"motorway|trunk|primary|secondary"]'],icon:"road"},{id:"places",name:"Places",type:"polygon",query:['way["highway"="pedestrian"]["area"="yes"]'],icon:"road"},{id:"rues",name:"Toutes les rues",type:"line",query:['way["highway"]["highway"!="footway"]["highway"!="cycleway"]["highway"!="path"]["highway"!="steps"]["area"!="yes"]'],icon:"road"},{id:"ruespietonnes",name:"Chemins piétons",type:"line",query:['way["highway"~"footway|cycleway|path|steps"]["area"!="yes"]["footway"!="sidewalk"]["footway"!="crossing"]'],icon:"road"},{id:"trafficSignals",name:"Feux tricolores",type:"point",query:['node["highway"="traffic_signals"]'],icon:"street-view"},{id:"batiments",name:"Batiments",type:"polygon",query:['way["building"]["building"!="no"]'],icon:"building-o"},{id:"eau",name:"Eau",type:"polygon",query:['relation["type"="multipolygon"]["natural"="water"]'],icon:"leaf"},{id:"parc",name:"Parc",type:"polygon",query:['way["leisure"="park"]'],icon:"leaf"}],g={bighash:textures.lines().orientation("vertical"),bighash_bg:textures.lines().orientation("vertical").background("white"),bighashm45:textures.lines().orientation("6/8"),bighashm45_bg:textures.lines().orientation("6/8").background("white"),bighash45:textures.lines().orientation("2/8"),bighash45_bg:textures.lines().orientation("2/8").background("white"),smallhash:textures.lines().orientation("vertical").thicker(),smallhash_bg:textures.lines().orientation("vertical").thicker().background("white"),smallhashm45:textures.lines().orientation("6/8").thicker(),smallhashm45_bg:textures.lines().orientation("6/8").thicker().background("white"),smallhash45:textures.lines().orientation("2/8").thicker(),smallhash45_bg:textures.lines().orientation("2/8").thicker().background("white"),waves:textures.paths().d("waves"),waves_bg:textures.paths().d("waves").background("white"),smalldots:textures.circles().complement(),smalldots_bg:textures.circles().complement().background("white"),smalldotsline:textures.circles().lighter().thicker().complement().strokeWidth(1.1).background("white"),smalldotsline_bg:textures.circles().lighter().thicker().complement().strokeWidth(1.1).background("white").background("white"),smalldotsthicker:textures.circles().lighter().thicker().complement().strokeWidth(1.1),smalldotsthicker_bg:textures.circles().lighter().thicker().complement().strokeWidth(1.1).background("white"),smalldotsthicker2:textures.circles().lighter().thicker().complement().strokeWidth(1.3),smalldotsthicker2_bg:textures.circles().lighter().thicker().complement().strokeWidth(1.3).background("white"),bigdots:textures.circles().fill("grey").heavier().complement(),bigdots_bg:textures.circles().fill("grey").heavier().complement().background("white"),squares45:textures.lines().orientation("2/8","6/8").size(20).strokeWidth(1),squares45_bg:textures.lines().orientation("2/8","6/8").size(20).strokeWidth(1).background("white"),caps:textures.paths().d("caps"),caps_bg:textures.paths().d("caps").background("white"),woven:textures.paths().d("woven"),woven_bg:textures.paths().d("woven").background("white")},h={line:[{id:"straight_2",name:"Trait 2",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"straight_3",name:"Trait 3",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"straight_5",name:"Trait 5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"none"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"straight_8",name:"Traits parallèles",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"8"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}],styleInner:[{k:"stroke",v:"white"},{k:"stroke-width",v:"4"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}]},{id:"straight_12",name:"Traits parallèles 2",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"12"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}],styleInner:[{k:"stroke",v:"white"},{k:"stroke-width",v:"8"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}]},{id:"straight_20",name:"Traits parallèles 3",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"20"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}],styleInner:[{k:"stroke",v:g.smalldotsline.url()},{k:"stroke-width",v:"15"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}]},{id:"straight_35",name:"Traits parallèles 4",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"35"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}],styleInner:[{k:"stroke",v:"white"},{k:"stroke-width",v:"30"},{k:"stroke-linecap",v:"round"},{k:"fill",v:"none"}]},{id:"dashed21_5",name:"Tirets 21_5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"10, 5"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed22_3",name:"Tirets 22_3",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"6, 6"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed22_5",name:"Tirets 22_5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"10, 10"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed42_3",name:"Tirets 42_3",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"12, 6"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed42_5",name:"Tirets 42_5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"20, 10"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed42_5",name:"Tirets 62_5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"30, 10"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed4212_3",name:"Tirets 4212_3",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"12, 6, 3, 6"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]},{id:"dashed4212_5",name:"Tirets 4212_5",style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"none"},{k:"stroke-dasharray",v:"20, 10, 5, 10"}],styleInner:[{k:"stroke-width",v:"0"},{k:"fill",v:"none"}]}],polygon:[{id:"bighash",name:"Hachures",style:[{k:"fill-pattern",v:"bighash"}]},{id:"bighash-45",name:"Hachures -45",style:[{k:"fill-pattern",v:"bighashm45"}]},{id:"bighash45",name:"Hachures 45",style:[{k:"fill-pattern",v:"bighash45"}]},{id:"smallhash",name:"Petites hachures",style:[{k:"fill-pattern",v:"smallhash"}]},{id:"smallhashm45",name:"Petites hachures -45",style:[{k:"fill-pattern",v:"smallhashm45"}]},{id:"smallhash45",name:"Petites hachures 45",style:[{k:"fill-pattern",v:"smallhash45"}]},{id:"waves",name:"Vagues",style:[{k:"fill-pattern",v:"waves"}]},{id:"bigdots",name:"Points",style:[{k:"fill-pattern",v:"bigdots"}]},{id:"smalldots",name:"Petits points",style:[{k:"fill-pattern",v:"smalldots"}]},{id:"smalldotsthicker",name:"Petits points rapprochés",style:[{k:"fill-pattern",v:"smalldotsthicker"}]},{id:"squares45",name:"Quadrillage 45",style:[{k:"fill-pattern",v:"squares45"}]},{id:"caps",name:"caps",style:[{k:"fill-pattern",v:"caps"}]},{id:"woven",name:"woven",style:[{k:"fill-pattern",v:"woven"}]},{id:"redfill",name:"Fond rouge",style:[{k:"fill",v:"red"}]},{id:"none",name:"Aucun",style:[{k:"fill",v:"none"}]}],point:[{id:"smallcircleempty",name:"Petit cercle vide",path:a.circlePath,radius:10,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"bigcircleempty",name:"Grand cercle vide",path:a.circlePath,radius:18,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"smallcircle",name:"Petit cercle plein",path:a.circlePath,radius:10,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"2"},{k:"fill",v:"grey"}]},{id:"bigcircle",name:"Grand cercle",path:a.circlePath,radius:18,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"2"},{k:"fill",v:"grey"}]},{id:"circleCross",name:"Cercle croix",path:a.circleCrossPath,radius:18,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"ovalempty",name:"Ovale vide",path:a.ovalPath,radius:18,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"oval",name:"Ovale",path:a.ovalPath,radius:18,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"2"},{k:"fill",v:"grey"}]},{id:"triangleempty",name:"Triangle vide",path:a.trianglePath,radius:22,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"triangle",name:"Triangle",path:a.trianglePath,radius:22,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"2"},{k:"fill",v:"grey"}]},{id:"squareempty",name:"Carré vide",path:a.squarePath,radius:20,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"none"}]},{id:"square",name:"Carré",path:a.squarePath,radius:20,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"2"},{k:"fill",v:"grey"}]},{id:"squareDiag",name:"Carré Diag",path:a.squareDiagPath,radius:25,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"squareCross",name:"Carré croix",path:a.squareCrossPath,radius:25,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"2"},{k:"fill",v:"none"}]},{id:"cross",name:"Croix",path:a.crossPath,radius:25,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"3"},{k:"fill",v:"black"}]},{id:"cross2",name:"Croix2",path:a.crossPath,radius:25,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"black"}]},{id:"cross3",name:"Croix3",path:a.crossPath,radius:30,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"5"},{k:"fill",v:"black"}]},{id:"horizontalRect",name:"horizontalRect",path:a.horizontalRectPath,radius:20,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"10"},{k:"fill",v:"black"}]},{id:"verticalRect",name:"verticalRect",path:a.verticalRectPath,radius:20,style:[{k:"stroke",v:"black"},{k:"stroke-width",v:"10"},{k:"fill",v:"black"}]},{id:"horizontalArrow",name:"horizontalArrow",path:a.horizontalArrowPath,radius:100,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"4"},{k:"fill",v:"grey"}]},{id:"horizontalArrowHash",name:"horizontalArrowHash",path:a.horizontalArrowPath,radius:100,style:[{k:"stroke-width",v:"0"},{k:"fill",v:g.smallhashm45.url()}]},{id:"horizontalArrowDots",name:"horizontalArrowDots",path:a.horizontalArrowPath,radius:100,style:[{k:"stroke",v:"#343434"},{k:"stroke-width",v:"2"},{k:"fill",v:g.smalldotsthicker2.url()}]},{id:"horizontalArrowMedium",name:"horizontalArrowMedium",path:a.horizontalArrowPath,radius:60,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"4"},{k:"fill",v:"grey"}]},{id:"horizontalArrowSmall",name:"horizontalArrowSmall",path:a.horizontalSmallArrowPath,radius:30,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"4"},{k:"fill",v:"grey"}]},{id:"verticalArrow",name:"verticalArrow",path:a.verticalArrowPath,radius:100,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"4"},{k:"fill",v:"grey"}]},{id:"verticalArrowHash",name:"verticalArrowHash",path:a.verticalArrowPath,radius:100,style:[{k:"stroke-width",v:"0"},{k:"fill",v:g.smallhashm45.url()}]},{id:"verticalArrowDots",name:"verticalArrowDots",path:a.verticalArrowPath,radius:100,style:[{k:"stroke",v:"#343434"},{k:"stroke-width",v:"2"},{k:"fill",v:g.smalldotsthicker2.url()}]},{id:"verticalArrowMedium",name:"verticalArrowMedium",path:a.verticalArrowPath,radius:60,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"4"},{k:"fill",v:"grey"}]},{id:"verticalArrowSmall",name:"verticalArrowSmall",path:a.verticalSmallArrowPath,radius:30,style:[{k:"stroke",v:"grey"},{k:"stroke-width",v:"4"},{k:"fill",v:"grey"}]}]},i="http://overpass-api.de/api/interpreter?data=";return{XAPI_URL:i,FONTS:c,COLORS:d,FORMATS:e,QUERY_LIST:f,POLYGON_STYLES:g,STYLES:h,leaflet:b}}]),angular.module("accessimapEditeurDerApp").service("exportData",["shareSvg",function(a){this.mapExport=function(b){var c=new JSZip,d=d3.select("#der").select("svg").node(),e=d.cloneNode(!0);if(c.file("carte_avec_source.svg",(new XMLSerializer).serializeToString(e)),d3.select(e).selectAll(".tiles").selectAll("*").remove(),d3.select(e).selectAll(".sourceDocument").remove(),d3.select(e).selectAll(".sourceDocument").selectAll("*").remove(),c.file("carte_sans_source.svg",(new XMLSerializer).serializeToString(e)),d3.select("#der-legend").selectAll("svg").node()){var f=d3.select("#der-legend").selectAll("svg").node();c.file("legende.svg",(new XMLSerializer).serializeToString(f))}c.file("commentaires.txt",$("#comment").val()),a.getInteractions().then(function(a){for(var d=[],e=0;e<a.grid.columns.length;e++)d.push({field:a.grid.columns[e].field});for(var f=[],e=0;e<a.grid.rows.length;e++)f.push(a.grid.rows[e].entity);d.shift(),d.pop();for(var g=f[0],h=f[1],e=0;e<d.length;e++){var i=d[e].field;d[e].name=g[i],d[e].expandable=h[i]}var j=d3.select("#der").append("xml"),k=j.append("config"),l=k.append("filters");l.selectAll("filter").data(d).enter().append("filter").attr("id",function(a){return a.field}).attr("name",function(a){return a.name}).attr("expandable",function(a){return a.expandable}),f.shift(),f.shift();var m=k.append("pois");m.selectAll("poi").data(f).enter().append("poi").attr("id",function(a){return a.id}).each(function(a){var b;d3.select("#der").select("svg").selectAll("path")[0].forEach(function(c){"poi-"+d3.select(c).attr("iid")===a.id&&(b=d3.select(c).attr("d"))});var c=d3.select(this);c.attr("id",a.id),c.attr("coord",b);var d=c.append("actions");d3.keys(a).forEach(function(b){"$$hashKey"!==b&&"deletable"!==b&&"id"!==b&&d.append("action").attr("filter",b).attr("value",a[b]).attr("protocol",function(){if(a[b]){var c=a[b]&&a[b].split(".")[a[b].split(".").length-1];return"mp3"===c?"mp3":"tts"}})})});var n=d3.select("#der").select("xml").node();c.file("interactions.xml",(new XMLSerializer).serializeToString(n));var o=c.generate({type:"blob"});saveAs(o,b+".zip")})}}]),angular.module("accessimapEditeurDerApp").controller("LocalmapCtrl",["$rootScope","$scope","$http","$location","usSpinnerService","initSvg","settings","shareSvg","editSvg","svgicon",function(a,b,c,d,e,f,g,h,i,j){function k(){var a=I.scale(M.scale()).translate(M.translate())();angular.forEach(b.geojson,function(a){d3.selectAll("path."+a.id).filter(function(a){return"Point"!==a.geometry.type}).attr("d",L),d3.selectAll("path.inner."+a.id).filter(function(a){return"Point"!==a.geometry.type}).attr("d",L),d3.selectAll("path."+a.id).filter(function(a){return"Point"===a.geometry.type}).attr("cx",function(a){return J(a.geometry.coordinates)[0]}).attr("cy",function(a){return J(a.geometry.coordinates)[1]}).attr("d",function(b){var c=J(b.geometry.coordinates);return a.style.path(c[0],c[1],a.style.radius)})}),J.scale(M.scale()/2/Math.PI).translate(M.translate());var c=O.attr("transform","scale("+a.scale+")translate("+a.translate+")").selectAll("image").data(a,function(a){return a});c.exit().remove(),c.enter().append("image").attr("xlink:href",function(a){var b="http://"+["a","b","c"][Math.floor(3*Math.random())];return b+=".tile.openstreetmap.org/"+a[2]+"/"+a[0]+"/"+a[1]+".png"}).attr("width",1).attr("height",1).attr("x",function(a){return a[0]}).attr("y",function(a){return a[1]})}function l(a,c,d){var e,f=P.append("g").attr("class","legend").attr("id",a.id);if("line"===a.type){e=f.append("line").attr("x1",function(){return 2*B}).attr("y1",function(){return 40*d+2*B}).attr("x2",function(){return 2*B+40}).attr("y2",function(){return 40*d+2*B}).attr("class","symbol").attr("fill","red");var h=f.append("line").attr("x1",function(){return 2*B}).attr("y1",function(){return 40*d+2*B}).attr("x2",function(){return 2*B+40}).attr("y2",function(){return 40*d+2*B}).attr("class","symbol").attr("class","inner").attr("fill","red");angular.forEach(c.style,function(a){var b=a.k,c=a.v;"function"==typeof c&&(c=c.url()),e.attr(b,c)}),c.styleInner&&angular.forEach(c.styleInner,function(a){var b=a.k,c=a.v;"function"==typeof c&&(c=c.url()),h.attr(b,c)})}"point"===a.type&&(e=f.append("path").attr("cx",2*B+20).attr("cy",40*d+2*B+c.radius/2).attr("d",function(){var a=parseFloat(d3.select(this).attr("cx")),b=parseFloat(d3.select(this).attr("cy"));return c.path(a,b,c.radius)}).attr("class","symbol").attr("fill","red")),"polygon"===a.type&&(e=f.append("rect").attr("x",function(){return 2*B}).attr("y",function(){return 40*d+2*B}).attr("width",function(){return 40}).attr("height",function(){return 15}).attr("class","symbol").attr("fill","red")),angular.forEach(c.style,function(a){var c=a.k,d=a.v;"fill-pattern"===c?(b.checkboxModel.fill&&(d+="_bg"),e.attr("fill",g.POLYGON_STYLES[d].url())):e.attr(c,d)}),b.checkboxModel.contour&&!e.attr("stroke")&&e.attr("stroke","black").attr("stroke-width","2"),f.append("text").attr("x",function(){return 2*B+50}).attr("y",function(){return 40*d+2*B+20}).attr("font-family","Braille_2007").attr("font-size","35px").attr("class","braille").text(function(){return a.name})}function m(){var a=d3.select("#map").select("svg").node(),b=d3.select("#legend").select("svg").node();M.on("zoom",null).on("zoomend",null),h.addMap(a).then(function(){h.addLegend(b).then(function(){d.path("/commonmap")})})}function n(a){var c=b.geojson.filter(function(b){return b.id===a}),d=b.geojson.indexOf(c[0]);b.geojson.splice(d,1),d3.select(".vector#"+a).remove(),d3.select(".vector.inner#"+a)&&d3.select(".vector.inner#"+a).remove(),d3.select(".legend#"+a).remove()}function o(a,c){var d=b.geojson.filter(function(b){return b.id===a}),e=b.geojson.indexOf(d[0]);b.geojson[e].contour?d3.select("#"+a).attr("stroke","black").attr("stroke-width","2"):d3.select("#"+a).attr("stroke",null).attr("stroke-width",null),angular.forEach(c.style,function(c){var d=c.k,f=c.v;"fill-pattern"===d?(b.geojson[e].fill&&(f+="_bg"),d3.select("#"+a).attr("fill",g.POLYGON_STYLES[f].url())):d3.select("#"+a).attr(d,f)}),c.styleInner&&angular.forEach(c.styleInner,function(b){var c=b.k,d=b.v;"fill-pattern"===c?d3.select(".inner#"+a).attr("fill",g.POLYGON_STYLES[d].url()):d3.select(".inner#"+a).attr(c,d)}),c.path&&(b.geojson[e].style.path=c.path,k());var f=d3.select(".legend#"+a).select(".symbol");if(b.geojson[e].contour?f.attr("stroke","black").attr("stroke-width","2"):f.attr("stroke",null).attr("stroke-width",null),angular.forEach(c.style,function(a){var c=a.k,d=a.v;"fill-pattern"===c?(b.geojson[e].fill&&(d+="_bg"),f.attr("fill",g.POLYGON_STYLES[d].url())):f.attr(c,d)}),c.styleInner){var h=d3.select(".legend#"+a).select(".inner");angular.forEach(c.styleInner,function(a){var b=a.k,c=a.v;"fill-pattern"===b?f.attr("fill",g.POLYGON_STYLES[c].url()):h.attr(b,c)})}c.path&&f.attr("d",function(){return c.path(f.attr("cx"),f.attr("cy"),c.radius)})}function p(a){d3.select(".vector#"+a.id).remove(),d3.select(".vector.inner#"+a.id)&&d3.select(".vector.inner#"+a.id).remove();var b=$.extend(!0,{},a.originallayer);r(b,a.simplification/1e5,a.id)}function q(a,c,d){var e;e=d?d3.select(".vector."+d+"#"+c[0].id).empty()?N.append("g").attr("class","vector "+d).attr("id",c[0].id):d3.select(".vector."+d+"#"+c[0].id):d3.select(".vector#"+c[0].id).empty()?N.append("g").attr("class","vector").attr("id",c[0].id):d3.select(".vector#"+c[0].id),e.selectAll("path").data(a.features.filter(function(a){return"Point"!==a.geometry.type})).enter().append("path").attr("class",function(){return d?c[0].id+" "+d:c[0].id}).attr("name",function(a){return a.properties.tags.name}).append("svg:title").text(function(a){return a.properties.tags.name}).attr("d",L).data(a.features.filter(function(a){return"Point"===a.geometry.type})).enter().append("path").attr("class",c[0].id).attr("name",function(a){return a.properties.tags.name}).attr("cx",function(a){return J(a.geometry.coordinates)[0]}).attr("cy",function(a){return J(a.geometry.coordinates)[1]}).attr("d",function(a){var b=J(a.geometry.coordinates);return c[0].style.path(b[0],b[1],c[0].style.radius)}),angular.forEach(c[0].style.style,function(a){var d=a.k,e=a.v;"fill-pattern"===d?(b.checkboxModel.fill&&(e+="_bg"),d3.select("#"+c[0].id).attr("fill",g.POLYGON_STYLES[e].url())):d3.select("#"+c[0].id).attr(d,e)}),d&&angular.forEach(c[0].style.styleInner,function(a){var e=a.k,f=a.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),d3.select("."+d+"#"+c[0].id).attr("fill",g.POLYGON_STYLES[f].url())):d3.select("."+d+"#"+c[0].id).attr(e,f)}),b.checkboxModel.contour&&!d3.select("#"+c[0].id).attr("stroke")&&d3.select("#"+c[0].id).attr("stroke","black").attr("stroke-width","2"),d&&angular.forEach(c[0].style["style_"+d],function(a){d3.select("."+d+"#"+c[0].id).attr(a.k,a.v)})}function r(a,c,d,e){if(a){a.features.forEach(function(b,d){c&&(a.features[d]=turf.simplify(b,c,!1))});var f;if(f=b.geojson.filter(d?function(a){return a.id===d}:function(a){return a.id===b.queryChosen.id}),0===f.length){var g;if(e){var h=a.features[0].properties.tags,i=h.name||h.amenity||h.shop||"POI";g={id:d,name:i,geometryType:b.queryChosen.type,layer:$.extend(!0,{},a),originallayer:$.extend(!0,{},a),style:b.styleChosen,styleChoices:b.styleChoices,rotation:0},l({type:"point",name:i,id:d},b.styleChosen,b.geojson.length)}else g={id:b.queryChosen.id,name:b.queryChosen.name,geometryType:b.queryChosen.type,layer:$.extend(!0,{},a),originallayer:$.extend(!0,{},a),style:b.styleChosen,styleChoices:b.styleChoices,contour:b.checkboxModel.contour,fill:b.checkboxModel.fill},l(b.queryChosen,b.styleChosen,b.geojson.length);b.geojson.push(g),q(a,[g]),b.styleChosen.styleInner&&q(a,[g],"inner")}else q(a,f),b.styleChosen.styleInner&&q(a,f,"inner");N.call(M),k()}}function s(){$("#map").css("cursor","crosshair"),d3.select("svg").on("click",function(){var a=d3.mouse(this),b=J.invert(a);t(b)})}function t(a){e.spin("spinner-1");var d,f,h,i;if(a)d=parseFloat(a[1])-5e-5,f=parseFloat(a[0])-5e-5,h=parseFloat(a[1])+5e-5,i=parseFloat(a[0])+5e-5;else{$("#map").css("cursor","auto");var j=J.invert([0,0]),k=J.invert([E,F]);d=k[1],f=j[0],h=j[1],i=k[0]}for(var l=g.XAPI_URL+"[out:xml];(",m=0;m<b.queryChosen.query.length;m++)l+=b.queryChosen.query[m],l+="("+d+","+f+","+h+","+i+");";l+=");out body;>;out skel qt;",c.get(l).success(function(a){var c=osmtogeojson((new DOMParser).parseFromString(a,"text/xml"));c.features.forEach(function(a,b){if("Polygon"===a.geometry.type){var d=a.geometry.coordinates.length;if(a.geometry.coordinates[0].reverse(),d>1)for(var e=1;d>e;e++){var f=a.geometry.coordinates[e].slice().reverse();c.features[b].geometry.coordinates[e]=f}}"MultiPolygon"===a.geometry.type&&a.geometry.coordinates.forEach(function(a){var d=a.length;if(a[0].reverse(),d>1)for(var e=1;d>e;e++)a[e]=a[e].slice().reverse();c.features.push({type:"Feature",properties:c.features[b].properties,geometry:{type:"Polygon",coordinates:a}})})}),"poi"===b.queryChosen.id?(c.features=[c.features[0]],c.features[0]&&r(c,void 0,"node_"+c.features[0].properties.id,!0)):r(c,void 0,void 0),e.stop("spinner-1")}).error(function(){e.stop("spinner-1")})}function u(a){var b="http://api-adresse.data.gouv.fr/search/?q="+a.target.value+"&limit=1";c.get(b).success(function(a){if(a.features[0]){var b=d3.geo.mercator().scale(M.scale()/2/Math.PI),c=b(a.features[0].geometry.coordinates),d=-c[0]+E,e=-c[1]+F;M.translate([d,e]),k()}})}var v=d.search().mapFormat,w=d.search().legendFormat,x=g.FORMATS[v].width,y=g.FORMATS[w].width,z=g.FORMATS[v].height,A=g.FORMATS[w].height,B=40,C=f.createMap(x,z),D=f.createLegend(x,z);f.createDefs(C);var E=x/.2822222,F=z/.2822222,G=y/.2822222,H=A/.2822222,I=d3.geo.tile().size([E,F]),J=d3.geo.mercator().scale(Math.pow(2,22)/2/Math.PI).translate([E/2,F/2]),K=J(g.leaflet.GLOBAL_MAP_CENTER),L=d3.geo.path().projection(J);b.leftMenuVisible=!1,b.hideMenu=function(){b.leftMenuVisible=!1},b.showMenu=function(){b.leftMenuVisible=!0};var M=d3.behavior.zoom().scale(2*J.scale()*Math.PI).scaleExtent([Math.pow(2,11),Math.pow(2,27)]).translate([E-K[0],F-K[1]]).on("zoom",k).on("zoomend",k);angular.forEach(g.POLYGON_STYLES,function(a){C.call(a),D.call(a)}),b.rotationAngle=0,b.checkboxModel={contour:!1,fill:!1};var N=C.append("g").attr("width",E).attr("height",F).attr("transform","rotate("+b.rotationAngle+")");f.createMargin(C,E,F),f.createMargin(D,G,H);var O=N.append("g").attr("class","tiles"),P=D.append("g").attr("width",G).attr("height",H);P.append("text").attr("x",function(){return B}).attr("y",function(){return 2*B}).attr("class","braille").attr("font-family","Braille_2007").attr("font-size","35px").text(function(){return"Légende"}),b.geojson=[],b.queryChoices=g.QUERY_LIST,b.queryChosen=b.queryChoices[0],b.styleChoices=g.STYLES[b.queryChosen.type],b.styleChosen=b.styleChoices[0],b.changeStyle=function(){b.styleChoices=g.STYLES[b.queryChosen.type],b.styleChosen=b.styleChoices[0]},b.rotateMap=function(){N.attr("transform","rotate("+b.rotationAngle+" "+E/2+" "+F/2+")")},b.rotateFeature=function(a){var b=d3.selectAll("."+a.id);angular.forEach(b[0],function(b){var c=d3.select(b).attr("cx"),d=d3.select(b).attr("cy");d3.select(b).attr("transform","rotate("+a.rotation+" "+c+" "+d+")")})},b.featureIcon=j.featureIcon,N.call(M),k(),b.downloadData=t,b.downloadPoi=s,b.removeFeature=n,b.updateFeature=o,b.simplifyFeatures=p,b.mapCommon=m,b.zoomOnPlace=u}]),angular.module("accessimapEditeurDerApp").controller("GlobalmapCtrl",["$scope","$rootScope","$http","$location","usSpinnerService","initSvg","settings","shareSvg",function(a,b,c,d,e,f,g,h){function i(a){var b=f.createDetachedSvg(210,297),c=742,e=1049,i=e/c,j=new Image;j.src=a,j.onload=function(){var f,j,k=this.width,l=this.height,m=l/k;m>i?(j=e,f=j/m):(f=c,j=f/m);b.append("g").classed("sourceDocument",!0).append("image").attr("x",0).attr("y",0).attr("width",f).attr("height",j).attr("xlink:href",a);
angular.forEach(g.POLYGON_STYLES,function(a){b.call(a)}),h.addMap(b.node()).then(function(){d.path("/commonmap")})}}function j(a){d3.xml(a,function(a){var b=d3.select(a.documentElement);angular.forEach(b[0][0].children,function(a){d3.select(a).classed("sourceDocument",!0)}),angular.forEach(g.POLYGON_STYLES,function(a){b.call(a)}),h.addMap(a.documentElement).then(function(){d.path("/commonmap")})})}a.mapCategories=[{id:"world",name:"Monde",images:[{path:"data/BlankMap-World6-Equirectangular.svg"}]},{id:"france",name:"France",images:[{path:"data/France_all_regions_A4.svg"}]}],a.uploadSvg=function(b){var c=b.files[0],d=c.type,e=new FileReader;e.readAsDataURL(c),e.onload=function(b){switch(a.accordionStyle={display:"none"},d){case"image/svg+xml":j(b.target.result);break;case"image/png":i(b.target.result);break;case"image/jpeg":i(b.target.result);break;default:console.log("Mauvais format")}}},a.appendSvg=j}]),angular.module("accessimapEditeurDerApp").service("initSvg",function(){this.createSvg=function(a,b,c){return d3.select(a).append("svg").attr("width",b+"mm").attr("height",c+"mm").attr("viewBox","0 0 "+b/.283+" "+c/.283)},this.createDetachedSvg=function(a,b){return d3.select(document.createElementNS(d3.ns.prefix.svg,"svg")).attr("width",a+"mm").attr("height",b+"mm").attr("viewBox","0 0 "+a/.283+" "+b/.283)},this.createMap=function(a,b){return this.createSvg("#map",a,b)},this.createLegend=function(a,b){return this.createSvg("#legend",a,b)},this.createDefs=function(a){a.append("defs").append("marker").attr("orient","auto").attr("refY","0.0").attr("refX","0.0").attr("id","arrowEnd").attr("style","overflow:visible").append("path").attr("d","M -5,-5 L 0,0 L -5,5").attr("style","fill:none;stroke:#000000;stroke-width:2.5px;stroke-opacity:1")},this.createMargin=function(a,b,c){var d=b-40,e=c-40,f=a.append("g").attr("id","margin").attr("width",b).attr("height",c);f.append("path").attr("d",function(){var a="M 0 0 L 0 "+c+" L "+b+" "+c+" L "+b+" 0 L 0 0 z ",f="M 40 40 L "+d+" 40 L "+d+" "+e+" L 40 "+e+" L 40 40 z";return a+f}).attr("style","opacity:1;fill:#ffffff;fill-opacity:1").attr("id","svgWhiteBorder").classed("notDeletable",!0),f.append("path").attr("d",function(){return"M 40 40 L "+d+" 40 L "+d+" "+e+" L 40 "+e+" L 40 40 z"}).attr("fill","none").attr("stroke","#000000").attr("stroke-width","2.5px").attr("stroke-opacity","1").attr("id","svgContainer").classed("notDeletable",!0)}}),angular.module("accessimapEditeurDerApp").controller("CommonmapCtrl",["$rootScope","$scope","$location","settings","exportData","shareSvg","svgicon","geometryutils",function(a,b,c,d,e,f,g,h){function i(){d3.selectAll("path").on("click",function(){}),d3.selectAll("svg").on("click",function(){}),d3.select("body").on("keydown",function(){}),d3.selectAll("path").attr("marker-mid",null),$("#der").css("cursor","auto"),d3.select(".ongoing").remove(),d3.selectAll(".blink").classed("blink",!1),d3.selectAll(".highlight").classed("highlight",!1)}function j(a){var b=document.createRange();b.selectNodeContents(a);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}function k(a){a.on("click",function(){if(!d3.select(this).classed("notDeletable")){var a=this,c=d3.select(this).attr("iid"),d=b.interactiveFilters.data.filter(function(a){return a.id==="poi-"+c}),e=b.interactiveFilters.data.indexOf(d[0]);if(e>-1){if(window.confirm("Ce point est interactif. Voules-vous vraiment le supprimer ?")){b.removeRow(b.interactiveFilters.data[e]),b.$apply(function(){b.deletedFeature=(new XMLSerializer).serializeToString(a)});var f=document.createElement("foreignObject");d3.select(f).attr("id","deletedElement"),this.parentNode.insertBefore(f,this),this.remove()}}else{b.$apply(function(){b.deletedFeature=(new XMLSerializer).serializeToString(a)});var f=document.createElement("foreignObject");d3.select(f).attr("id","deletedElement"),this.parentNode.insertBefore(f,this),this.remove()}}})}d3.select("#der").selectAll("svg").remove(),f.getMap().then(function(a){a?(b.data=a,d3.select("#der").node().appendChild(b.data)):c.path("/")}),f.getLegend().then(function(a){a&&d3.select("#der-legend").node().appendChild(a)}),b.filename="map",b.fonts=d.FONTS,b.fontChosen=b.fonts[0],b.colors=d.COLORS,b.colorChosen=b.colors[b.fontChosen.color][0],b.mode="default",b.styleChoices=[],b.styleChosen=b.styleChoices[0],b.deletedFeature=null,b.checkboxModel={contour:!1,fill:!1},b.featureIcon=g.featureIcon,b.containerStyleChoices=d.STYLES.polygon,b.containerStyle=b.containerStyleChoices[0],b.changeContainerStyle=function(a){angular.forEach(a.style,function(a){var b=a.k,c=a.v;"fill-pattern"===b?d3.select("#svgContainer").attr("fill",d.POLYGON_STYLES[c].url()):d3.select("#svgContainer").attr(b,c)})},b.rightMenuVisible=!1,b.hideMenu=function(){b.rightMenuVisible=!1},b.showMenu=function(){d3.selectAll(".highlight").classed("highlight",!1),b.rightMenuVisible=!0},b.interactiveFiltersInit=[{id:"name",f0:"Aucune interaction",f1:"Valeur OSM",deletable:!1},{id:"Guidage",f0:!1,f1:!0,type:"boolean",deletable:!1},{id:"title",f0:"Titre par défaut",deletable:!1}];var l='<input ng-if="row.entity.type === \'boolean\'" type="checkbox" value="{{row.entity[col.field]}}" ng-model="row.entity[col.field]">';l+="<div ng-if=\"row.entity.type !== 'boolean'\">{{row.entity[col.field]}}</div>";var m='<button ng-if="row.entity.deletable" class="btn btn-danger" ng-click="grid.appScope.removeRow(row.entity)"><i class="glyphicon glyphicon-remove"></i></button>',n=function(a,c,d,e){return b.interactiveFilters.data[e].id+" highlight"};b.deleteCol=function(a){var c=o.filter(function(b){return b.name===a}),d=o.indexOf(c[0]);d>-1&&o.splice(d,1),angular.forEach(b.interactiveFilters.data,function(b){delete b[a]})};var o=[{name:"id",enableCellEdit:!1,enableHiding:!1,cellClass:n},{name:"f0",cellTemplate:l,menuItems:[{title:"Supprimer cette colonne",icon:"ui-grid-icon-cancel",action:function(){var a=this.context.col.name;b.deleteCol(a)}}],enableHiding:!1,cellClass:n},{name:"f1",cellTemplate:l,menuItems:[{title:"Supprimer cette colonne",icon:"ui-grid-icon-cancel",action:function(){var a=this.context.col.name;b.deleteCol(a)}}],enableHiding:!1,cellClass:n},{field:"remove",displayName:"",width:40,cellTemplate:m,enableCellEdit:!1,enableHiding:!1,cellClass:n}];b.interactiveFilters={data:b.interactiveFiltersInit,showSelectionCheckbox:!0,enableSorting:!1,enableRowSelection:!0,columnDefs:o,onRegisterApi:function(a){f.addInteractions(a)}},b.nextFilterNumber=2,b.addFilter=function(){var a=o.length-1;o.splice(a,0,{name:"f"+b.nextFilterNumber,cellTemplate:l,menuItems:[{title:"Supprimer cette colonne",icon:"ui-grid-icon-cancel",action:function(){var a=this.context.col.name;b.deleteCol(a)}}],enableHiding:!1,cellClass:n}),b.nextFilterNumber+=1},b.removeRow=function(a){var c=b.interactiveFilters.data.indexOf(a);-1!==c&&b.interactiveFilters.data.splice(c,1)},d3.select("svg").append("defs").append("marker").attr("id","midmarker").attr("refX",2).attr("refY",2).attr("markerWidth",4).attr("markerHeight",4).attr("orient","auto").append("circle").attr("cx","2").attr("cy","2").attr("r","2"),b.changeColor=function(){b.colorChosen=b.colors[b.fontChosen.color][0]},b.updatePolygonStyle=function(){if("editpolygon"===b.mode){var a=d3.select(".blink");b.$watch(b.styleChosen,function(){angular.forEach(b.styleChosen.style,function(c){var e=c.k,f=c.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),a.attr("fill",d.POLYGON_STYLES[f].url())):a.attr(e,f)}),b.checkboxModel.contour?a.attr("stroke","black").attr("stroke-width","2"):a.attr("stroke",null).attr("stroke-width",null)})}},b.$watch("mode",function(){if("default"===b.mode&&i(),"delete"===b.mode&&(i(),$("#der").css("cursor","crosshair"),d3.select("#deletedElement").remove(),k(d3.selectAll("path")),k(d3.selectAll("circle")),k(d3.selectAll("text")),k(d3.selectAll("rect")),k(d3.selectAll("ellipse"))),"undo"===b.mode&&(i(),b.deletedFeature)){var c=d3.select("#deletedElement").node(),e=document.createElement("path");d3.select(e).attr("id","restoredElement"),c.parentNode.insertBefore(e,c),d3.select("#restoredElement").node().outerHTML=b.deletedFeature,d3.select("#deletedElement").remove(),b.deletedFeature=null}if("move"===b.mode&&(i(),d3.selectAll("path:not(.notDeletable)").attr("marker-mid",function(){return"url(#midmarker)"}).on("click",function(){d3.selectAll(".blink").classed("blink",!1),d3.select(this).classed("blink",!0);var a=this.pathSegList;d3.select("svg").on("click",function(){var b=[];angular.forEach(a,function(a,c){a.x&&a.y&&b.push([a.x,a.y,c])});var c=[d3.mouse(this)[0],d3.mouse(this)[1]],d=h.nearest(c,b);a[d[2]].x=c[0],a[d[2]].y=c[1]})})),"editpolygon"===b.mode&&(i(),b.styleChoices=d.STYLES.polygon,b.styleChosen=b.styleChoices[0],d3.selectAll("path:not(.notDeletable)").on("click",function(){var a=d3.select(this),c=a.attr("d").slice(-1);if("z"===c||"Z"===c){d3.selectAll(".blink").classed("blink",!1),a.classed("blink",!0),b.$apply(a.attr("stroke")?function(){b.checkboxModel.contour=!0}:function(){b.checkboxModel.contour=!1});var d=a.attr("fill");if(d){var e=d.match(/\((.+?)\)/g)[0].slice(1,-1),f=d3.select(e).select("rect").node();b.$apply(f?function(){b.checkboxModel.fill=!0}:function(){b.checkboxModel.fill=!1})}}})),"interaction"===b.mode&&(i(),$("#der").css("cursor","crosshair"),d3.selectAll("path:not(.notDeletable)").on("click",function(){d3.selectAll(".blink").classed("blink",!1),d3.selectAll(".highlight").classed("highlight",!1);var c=d3.select(this);c.classed("blink",!0);var d;d=c.attr("iid"),d||(console.log(a),d=a.getiid(),c.attr("iid",d)),d3.selectAll(".poi-"+d).classed("highlight",!0);var e=b.interactiveFilters.data.filter(function(a){return a.id==="poi-"+d}),f=b.interactiveFilters.data.indexOf(e[0])<0;f&&b.$apply(function(){b.interactiveFilters.data.push({id:"poi-"+d,f1:c.attr("name"),deletable:!0})})})),"point"===b.mode&&(i(),$("#der").css("cursor","crosshair"),b.styleChoices=d.STYLES[b.mode],b.styleChosen=b.styleChoices[0],d3.select("svg").on("click",function(){var c=d3.mouse(this),e=d3.select("svg").append("path").attr("d",b.styleChosen.path(c[0],c[1],b.styleChosen.radius)).attr("iid",a.getiid());angular.forEach(b.styleChosen.style,function(a){var c=a.k,f=a.v;"fill-pattern"===c?(b.checkboxModel.fill&&(f+="_bg"),e.attr("fill",d.POLYGON_STYLES[f].url())):e.attr(c,f)})})),"circle"===b.mode&&(i(),$("#der").css("cursor","crosshair"),b.styleChoices=d.STYLES.polygon,b.styleChosen=b.styleChoices[0],d3.select("svg").on("click",function(){var a,c=d3.mouse(this);if(d3.select(".edition")[0][0]){a=d3.select(".edition");var e=c[0]-a.attr("cx"),f=c[1]-a.attr("cy"),g=Math.sqrt(Math.pow(e,2)+Math.pow(f,2));a.attr("r",g),a.classed("edition",!1)}else a=d3.select("svg").append("circle").attr("cx",c[0]).attr("cy",c[1]).attr({"class":"edition"}),angular.forEach(b.styleChosen.style,function(c){var e=c.k,f=c.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),a.attr("fill",d.POLYGON_STYLES[f].url())):a.attr(e,f)}),b.checkboxModel.contour&&!a.attr("stroke")&&a.attr("stroke","black").attr("stroke-width","2")}).on("mousemove",function(){var a=d3.select(".edition");if(a[0][0]){var b=d3.mouse(this),c=b[0]-a.attr("cx"),d=b[1]-a.attr("cy"),e=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));a.attr("r",e)}})),"line"===b.mode||"polygon"===b.mode){i(),$("#der").css("cursor","crosshair"),b.styleChoices=d.STYLES[b.mode],b.styleChosen=b.styleChoices[0];var f=[],g=null,l=d3.svg.line().x(function(a){return a[0]}).y(function(a){return a[1]}).interpolate("linear");d3.select("svg").on("click",function(){var a,c;d3.select(".edition")[0][0]?(a=d3.select(".edition"),"line"===b.mode&&(c=d3.select(".edition.inner"))):(f=[],a=d3.select("svg").append("path").attr({"class":"edition"}),angular.forEach(b.styleChosen.style,function(c){var e=c.k,f=c.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),a.attr("fill",d.POLYGON_STYLES[f].url())):a.attr(e,f)}),b.checkboxModel.contour&&!a.attr("stroke")&&a.attr("stroke","black").attr("stroke-width","2"),"line"===b.mode&&(c=d3.select("svg").append("path").attr({"class":"edition inner"}),angular.forEach(b.styleChosen.styleInner,function(a){var e=a.k,f=a.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),c.attr("fill",d.POLYGON_STYLES[f].url())):c.attr(e,f)})));var e=d3.mouse(this);g=e,f.push(e),a.attr({d:l(f)}),"line"===b.mode&&c.attr({d:l(f)}),angular.forEach(b.styleChosen.style,function(c){var e=c.k,f=c.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),a.attr("fill",d.POLYGON_STYLES[f].url())):a.attr(e,f)}),b.checkboxModel.contour&&!a.attr("stroke")&&a.attr("stroke","black").attr("stroke-width","2"),"line"===b.mode&&angular.forEach(b.styleChosen.styleInner,function(a){var e=a.k,f=a.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),c.attr("fill",d.POLYGON_STYLES[f].url())):c.attr(e,f)})}).on("dblclick",function(){if("polygon"===b.mode){var a=d3.select(".edition").attr("d");a=a.replace(a.substr(a.lastIndexOf("L")),""),d3.select(".edition").attr({d:a+"Z"})}d3.select(".edition").classed("edition",!1),"line"===b.mode&&d3.select(".edition.inner").classed("edition",!1),d3.select(".ongoing").remove(),g=null}).on("mousemove",function(){if(g){var a;d3.select(".ongoing")[0][0]?a=d3.select(".ongoing"):(a=d3.select("svg").append("line").attr({"class":"ongoing"}),angular.forEach(b.styleChosen.style,function(c){var e=c.k,f=c.v;"fill-pattern"===e?(b.checkboxModel.fill&&(f+="_bg"),a.attr("fill",d.POLYGON_STYLES[f].url())):a.attr(e,f)}),b.checkboxModel.contour&&!a.attr("stroke")&&a.attr("stroke","black").attr("stroke-width","2"));var c=d3.mouse(this);a.attr("x1",g[0]).attr("y1",g[1]).attr("x2",c[0]).attr("y2",c[1])}})}"addtext"===b.mode&&(i(),$("#der").css("cursor","crosshair"),d3.select("svg").on("click",function(){d3.select(".edition").classed("edition",!1);var a=d3.mouse(this),c="Texte";d3.select("svg").append("text").attr("x",a[0]).attr("y",a[1]-35).attr("font-family",b.fontChosen.family).attr("font-size",b.fontChosen.size).attr("font-weight",function(){return b.fontChosen.weight}).attr("fill",b.colorChosen.color).attr({"class":"edition"}).text(""),d3.select("svg").selectAll("foreignObject").data([c]).enter().append("foreignObject").attr("x",a[0]).attr("y",a[1]-35).attr("height",500).attr("width",500).attr("font-family",b.fontChosen.family).attr("font-size",b.fontChosen.size).attr("font-weight",function(){return b.fontChosen.weight}).attr("fill",b.colorChosen.color).attr({"class":"edition"}).append("xhtml:p").attr("contentEditable","true").text(c).on("mousedown",function(){d3.event.stopPropagation()}).on("keydown",function(){d3.event.stopPropagation(),13!==d3.event.keyCode||d3.event.shiftKey||this.blur()}).on("blur",function(){angular.forEach(this.childNodes,function(a){var b=a.data;b&&(b=b.replace(/(\d+)/g,"¤$1"),d3.select(".edition").attr("text-anchor","start").append("tspan").attr("text-anchor","start").attr("x",function(){return d3.select(this.parentNode).attr("x")}).attr("dy",35).text(b))}),d3.select(this.parentElement).remove(),d3.select(".edition").classed("edition",!1)}),j(d3.selectAll(this.getElementsByTagName("foreignObject")).selectAll("p").node()),b.$apply(function(){b.mode="default"}),i()}))}),b.mapExport=e.mapExport}]),angular.module("accessimapEditeurDerApp").service("shareSvg",["$q",function(a){var b,c,d,e=function(c){var d=a.defer();return b=c,d.resolve(),d.promise},f=function(){var c=a.defer();return c.resolve(b),c.promise},g=function(b){var d=a.defer();return c=b,d.resolve(),d.promise},h=function(){var b=a.defer();return b.resolve(c),b.promise},i=function(b){var c=a.defer();return d=b,c.resolve(),c.promise},j=function(){var b=a.defer();return b.resolve(d),b.promise};return{addMap:e,getMap:f,addLegend:g,getLegend:h,addInteractions:i,getInteractions:j}}]),angular.module("accessimapEditeurDerApp").service("editSvg",function(){this.circlePath=function(a,b,c){var d="M "+a+" "+b;return d+=" m -"+c+", 0",d+=" a "+c+","+c+" 0 1,0 "+2*c+",0",d+=" a "+c+","+c+" 0 1,0 -"+2*c+",0"},this.circleCrossPath=function(a,b,c){var d="M "+a+" "+b;return d+=" m -"+c+", 0",d+=" a "+c+","+c+" 0 1,0 "+2*c+",0",d+=" a "+c+","+c+" 0 1,0 -"+2*c+",0",d+=" Z",c/=Math.cos(45*Math.PI/180),d+=" M "+(a-c/2)+" "+(b-c/2),d+=" L "+(a+c/2)+" "+(b+c/2),d+=" Z",d+=" M "+(a-c/2)+" "+(b+c/2),d+=" L "+(a+c/2)+" "+(b-c/2),d+=" Z"},this.ovalPath=function(a,b,c){var d="M "+a+" "+b;return d+=" m -"+c/2+", 0",d+=" a "+c/2+","+c+" 0 1,0 "+c+",0",d+=" a "+c/2+","+c+" 0 1,0 -"+c+",0"},this.trianglePath=function(a,b,c){var d="M "+(a-c/2)+" "+b;return d+=" L"+a+" "+(b-Math.sqrt(3*c*c/4)),d+=" L"+(a+c/2)+" "+b,d+=" Z"},this.squarePath=function(a,b,c){var d="M "+(a-c/2)+" "+(b-c/2);return d+=" v"+c,d+=" h"+c,d+=" v"+-c,d+=" Z"},this.squareDiagPath=function(a,b,c){var d="M "+(a-c/2)+" "+(b-c/2);return d+=" v"+c,d+=" h"+c,d+=" v"+-c,d+=" Z",d+=" M "+(a-c/2)+" "+(b-c/2),d+=" L "+(a+c/2)+" "+(b+c/2),d+=" Z"},this.squareCrossPath=function(a,b,c){var d="M "+(a-c/2)+" "+(b-c/2);return d+=" v"+c,d+=" h"+c,d+=" v"+-c,d+=" Z",d+=" M "+(a-c/2)+" "+(b-c/2),d+=" L "+(a+c/2)+" "+(b+c/2),d+=" Z",d+=" M "+(a-c/2)+" "+(b+c/2),d+=" L "+(a+c/2)+" "+(b-c/2),d+=" Z"},this.crossPath=function(a,b,c){var d="M "+(a-c/2)+" "+b;return d+=" h"+c,d+=" Z",d+="M "+a+" "+(b-c/2),d+=" v"+c,d+=" Z"},this.horizontalRectPath=function(a,b,c){var d="M "+(a-c/2)+" "+b;return d+=" h"+c,d+=" Z"},this.verticalRectPath=function(a,b,c){var d="M "+a+" "+(b-c/2);return d+=" v"+c,d+=" Z"},this.horizontalArrowPath=function(a,b,c){var d="M "+a+" "+b;return d+=" L"+(a-3*c/10)+" "+(b-3*c/10),d+=" L"+(a-3*c/10)+" "+(b-1*c/10),d+=" L"+(a-12*c/10)+" "+(b-1*c/10),d+=" L"+(a-12*c/10)+" "+(b+1*c/10),d+=" L"+(a-3*c/10)+" "+(b+1*c/10),d+=" L"+(a-3*c/10)+" "+(b+3*c/10),d+=" Z"},this.horizontalSmallArrowPath=function(a,b,c){var d="M "+a+" "+b;return d+=" L"+(a-5*c/10)+" "+(b-4*c/10),d+=" L"+(a-5*c/10)+" "+(b-1*c/10),d+=" L"+(a-12*c/10)+" "+(b-1*c/10),d+=" L"+(a-12*c/10)+" "+(b+1*c/10),d+=" L"+(a-5*c/10)+" "+(b+1*c/10),d+=" L"+(a-5*c/10)+" "+(b+4*c/10),d+=" Z"},this.verticalArrowPath=function(a,b,c){var d="M "+a+" "+b;return d+=" L"+(a-3*c/10)+" "+(b+3*c/10),d+=" L"+(a-1*c/10)+" "+(b+3*c/10),d+=" L"+(a-1*c/10)+" "+(b+12*c/10),d+=" L"+(a+1*c/10)+" "+(b+12*c/10),d+=" L"+(a+1*c/10)+" "+(b+3*c/10),d+=" L"+(a+3*c/10)+" "+(b+3*c/10),d+=" Z"},this.verticalSmallArrowPath=function(a,b,c){var d="M "+a+" "+b;return d+=" L"+(a-4*c/10)+" "+(b+5*c/10),d+=" L"+(a-1*c/10)+" "+(b+5*c/10),d+=" L"+(a-1*c/10)+" "+(b+12*c/10),d+=" L"+(a+1*c/10)+" "+(b+12*c/10),d+=" L"+(a+1*c/10)+" "+(b+5*c/10),d+=" L"+(a+4*c/10)+" "+(b+5*c/10),d+=" Z"}}),angular.module("accessimapEditeurDerApp").service("svgicon",["settings",function(a){var b=function(b,c){var d,e=document.createElement("svg"),f=d3.select(e).attr("height",40).append("g");if("line"===c){d=f.append("line").attr("x1",0).attr("y1",15).attr("x2",250).attr("y2",15).attr("fill","red");var g=f.append("line").attr("x1",0).attr("y1",15).attr("x2",250).attr("y2",15).attr("fill","red");angular.forEach(b.styleInner,function(a){var b=a.k,c=a.v;"function"==typeof c&&(c=c.url()),g.attr(b,c)})}return"point"===c&&(d=f.append("path").attr("d",function(){return b.path(20,20,b.radius)})),("polygon"===c||"editpolygon"===c||"circle"===c)&&(d=f.append("rect").attr("x",0).attr("y",0).attr("width",250).attr("height",30).attr("fill","red")),angular.forEach(b.style,function(b){var c=b.k,e=b.v;"fill-pattern"===c?d.attr("fill",a.POLYGON_STYLES[e].url()):d.attr(c,e)}),(new XMLSerializer).serializeToString(e)};return{featureIcon:b}}]),angular.module("accessimapEditeurDerApp").filter("layerNotSelected",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){var d=!0;angular.forEach(b,function(b){a.id===b.id&&(d=!1)}),d&&c.push(a)}),c}}),angular.module("accessimapEditeurDerApp").service("geometryutils",function(){this.distance=function(a,b){var c=Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2));return c},this.nearest=function(a,b){var c,d=this;return b.forEach(function(b){var e=d.distance(a,b);c?e<c[3]&&(c=b,c[3]=e):(c=b,c[3]=e)}),c},this.isClockwise=function(a){for(var b,c,d=0,e=1,f=a.length;f>e;)b=c||a[0],c=a[e],d+=(c[0]-b[0])*(c[1]+b[1]),e++;return d>0}});